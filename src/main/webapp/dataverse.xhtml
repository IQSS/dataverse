<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
    </h:head>

    <h:body>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{empty DataversePage.dataverse.name ? bundle.new : DataversePage.dataverse.name} #{bundle.dataverse}"/>
            <ui:param name="dataverse" value="#{DataversePage.dataverse}"/>
            <ui:param name="showBreadcrumbs" value="#{empty DataversePage.editMode}"/>
            <ui:define name="body">
                <f:metadata>
                    <f:viewParam name="id" value="#{DataversePage.dataverse.id}"/>
                    <f:viewParam name="alias" value="#{DataversePage.dataverse.alias}"/>
                    <f:viewParam name="ownerId" value="#{DataversePage.ownerId}"/>
                    <f:viewParam name="editMode" value="#{DataversePage.editMode}"/>
                    <f:viewAction action="#{DataversePage.init}"/>
                    <f:viewParam name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                    <f:viewParam name="alias" value="#{SearchIncludeFragment.dataverseAlias}"/>
                    <f:viewParam name="q" value="#{SearchIncludeFragment.query}"/>
                    <f:viewParam name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                    <f:viewParam name="fq1" value="#{SearchIncludeFragment.fq1}"/>
                    <f:viewParam name="fq0" value="#{SearchIncludeFragment.fq0}"/>
                    <f:viewParam name="fq2" value="#{SearchIncludeFragment.fq2}"/>
                    <f:viewParam name="fq3" value="#{SearchIncludeFragment.fq3}"/>
                    <f:viewParam name="fq4" value="#{SearchIncludeFragment.fq4}"/>
                    <f:viewParam name="fq5" value="#{SearchIncludeFragment.fq5}"/>
                    <f:viewParam name="fq6" value="#{SearchIncludeFragment.fq6}"/>
                    <f:viewParam name="fq7" value="#{SearchIncludeFragment.fq7}"/>
                    <f:viewParam name="fq8" value="#{SearchIncludeFragment.fq8}"/>
                    <f:viewParam name="fq9" value="#{SearchIncludeFragment.fq9}"/>
                    <f:viewParam name="sort" value="#{SearchIncludeFragment.sortField}"/>
                    <f:viewParam name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                    <f:viewParam name="page" value="#{SearchIncludeFragment.page}"/>
                    <f:viewParam name="debug" value="#{SearchIncludeFragment.debug}"/>
                    <f:viewAction action="#{SearchIncludeFragment.search()}" />
                </f:metadata>

                <h:form id="dataverseForm">
                        <p:focus context="dataverseForm"/>
                        
                        <!-- Name Panel -->
                        <p:panel styleClass="panelLayoutBlock" rendered="#{DataversePage.editMode == 'INFO'}">
                            <p:panelGrid styleClass="panelgridLayoutTable" columns="2">
                                <p:panelGrid columns="2" style="width:100%;">
                                    <ui:fragment>
                                        <div class="col-sm-12 form-group" style="margin-bottom:0;">
                                            <div class="col-sm-6">
                                                <p:inputText id="name" tabindex="1" styleClass="form-control" style="margin-right:.5em;" value="#{DataversePage.dataverse.name}"/>
                                            </div>
                                            <label class="control-label" style="padding-right:1em;" for="name">
                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.title']}">
                                                    #{bundle.dataverse} <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span>
                                                </a>
                                            </label>
                                            <p:watermark for="name" value="#{bundle['dataverse.enterName']}"/>
                                        </div>
                                    </ui:fragment>
                                    <p:message for="name" display="text"/>
                                </p:panelGrid>
                                <p:panelGrid columns="2" rendered="#{DataversePage.ownerId != null}">
                                    <label class="control-label" style="padding-right:1em;" for="hostDataverse">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.host.title']}">
                                            #{bundle.hostDataverse}
                                        </a>
                                    </label>
                                    <h:outputText value="#{ DataversePage.dataverse.getOwner().name }" />
                                    <h:inputHidden value="#{DataversePage.ownerId}" id="hostDataverse" />
                                    <ui:remove><!-- removed for beta -->
                                        <p:selectOneMenu id="hostDataverse" tabindex="2" value="#{DataversePage.ownerId}" filter="true" filterMatchMode="startsWith" effect="none">
                                            <f:selectItems value="#{dataverseServiceBean.findAll()}" var="dv" itemLabel="#{dv.name}" itemValue="#{dv.id}"
                                                           itemDisabled="#{dv eq DataversePage.dataverse or dv.owners.contains(DataversePage.dataverse)}" />
                                        </p:selectOneMenu>
                                    </ui:remove>
                                </p:panelGrid>
                            </p:panelGrid>
                        </p:panel>

                        <!-- Edit Info Panel -->
                        <p:panel styleClass="panelLayoutBlock" rendered="#{DataversePage.editMode == 'INFO'}">
                            <div class="row form-horizontal">
                                <div class="col-xs-6 form-group">
                                    <label class="col-sm-3 control-label" for="alias" style="white-space:nowrap;">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.url.title']}">
                                            #{bundle.url} <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span>
                                        </a>
                                    </label>
                                    <div class="col-sm-9">
                                        <p:panelGrid columns="2">
                                            <p:inputText id="alias" tabindex="3" styleClass="form-control" validator="#{DataversePage.validateAlias}" value="#{DataversePage.dataverse.alias}"/>
                                            <p:message for="alias" display="text"/>
                                        </p:panelGrid>
                                    </div>
                                    <label class="col-sm-3 control-label" for="affiliation" style="white-space:nowrap;">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.affiliation.title']}">
                                            #{bundle.affiliation}
                                        </a>
                                    </label>
                                    <div class="col-sm-9">
                                        <p:panelGrid columns="2">
                                            <p:inputText id="affiliation" tabindex="5" styleClass="form-control" value="#{DataversePage.dataverse.affiliation}"/>
                                            <p:message for="affiliation" display="text"/>
                                        </p:panelGrid>
                                    </div>

                                    <label class="col-sm-3 control-label" for="dataverseCategory">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.category']}">
                                            #{bundle['dataverse.category']} <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span>
                                        </a>
                                    </label>
                                    <div class="col-sm-9">
                                        <p:panelGrid columns="2">
                                            <h:selectOneMenu id="dataverseCategory" tabindex="6" styleClass="form-control" value="#{DataversePage.dataverse.dataverseType}">
                                                <f:selectItem id="dvSelect" itemLabel="#{bundle['dataverse.type.selectTab.top']}" itemValue="" />
                                                <f:selectItem id="dvResearch" itemLabel="#{bundle['dataverse.type.selectTab.researchers']}" itemValue="RESEARCHERS" />
                                                <f:selectItem id="dvResearchProj" itemLabel="#{bundle['dataverse.type.selectTab.researchProjects']}" itemValue="RESEARCH_PROJECTS" />
                                                <f:selectItem id="dvJournals" itemLabel="#{bundle['dataverse.type.selectTab.journals']}" itemValue="JOURNALS" />
                                                <f:selectItem id="dvOrgInst" itemLabel="#{bundle['dataverse.type.selectTab.organizationsAndInsitutions']}" itemValue="ORGANIZATIONS_INSTITUTIONS" />
                                                <f:selectItem id="dvTeaching" itemLabel="#{bundle['dataverse.type.selectTab.teachingCourses']}" itemValue="TEACHING_COURSES" />
                                                <f:selectItem id="dvUncategorized" itemLabel="#{bundle['dataverse.type.selectTab.uncategorized']}" itemValue="UNCATEGORIZED" />
                                            </h:selectOneMenu>
                                            <p:message for="dataverseCategory" display="text"/>
                                        </p:panelGrid>
                                    </div>
                                    <label class="col-sm-3 control-label" for="description">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.description.title']}">
                                            #{bundle.description}
                                        </a>
                                    </label>
                                    <div class="col-sm-9">
                                        <p:inputTextarea id="description" tabindex="7" styleClass="form-control" value="#{DataversePage.dataverse.description}"
                                                         rows="6" cols="50"
                                                         autoResize="false">
                                        </p:inputTextarea>
                                    </div>
                                    <div class="col-sm-2 control-label">
                                        <p:message for="description" display="text"/>
                                    </div>                                    
                                </div>
                                <div class="col-xs-6 form-group">
                                    <p:fragment autoUpdate="true">
                                    <label class="col-sm-3 control-label" for="contactEmail" style="white-space:nowrap;">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.email.title']}">
                                            #{bundle['dataverse.email']} <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span>
                                        </a>
                                    </label>
                                    <div class="form-col-container col-sm-12">
                                        <ui:repeat value="#{DataversePage.dataverse.dataverseContacts}" var="contacts" varStatus="valCount">
                                            <div class="form-group">
                                                <div class="form-col-container col-sm-9">
                                                    <p:panelGrid columns="2">
                                                        <p:inputText id="contactEmail" tabindex="4" styleClass="form-control" value="#{contacts.contactEmail}">
                                                            <f:validateBean disabled="#{param['SKIP_VALIDATION']}"/>
                                                        </p:inputText>
                                                        <p:message for="contactEmail" display="text"/>
                                                    </p:panelGrid>
                                                </div>
                                                <!-- Add / Remove buttons -->
                                                <div class="col-xs-3">
                                                    <p:commandButton styleClass="btn btn-default btn-sm" style="#{'margin:0 1em 0 0;'}"
                                                                     title="#{bundle['dataverse.record.add']}" value="&lt;span class='glyphicon glyphicon-plus'&gt;&lt;/span&gt;" escape="false"
                                                                     actionListener="#{DataversePage.dataverse.addDataverseContact(valCount.index + 1)}">
                                                        <f:param name="SKIP_VALIDATION" value="true"/>
                                                    </p:commandButton>
                                                    <p:commandButton styleClass="btn btn-default btn-sm"
                                                                     title="#{bundle['dataverse.record.delete']}" value="&lt;span class='glyphicon glyphicon-minus'&gt;&lt;/span&gt;" escape="false"
                                                                     rendered="#{DataversePage.dataverse.dataverseContacts.size() > 1}"
                                                                     actionListener="#{DataversePage.dataverse.removeDataverseContact(valCount.index)}">
                                                        <f:param name="SKIP_VALIDATION" value="true"/>
                                                    </p:commandButton>
                                                </div>
                                            </div>   
                                        </ui:repeat>
                                    </div> 
                                    </p:fragment>                                    
                                </div>
                            </div>
                        </p:panel>

                        <p:commandButton id="hiddenRefresh" value="back"  style="display:none" rendered="#{DataversePage.editMode == 'INFO'}"
                                         actionListener="#{DataversePage.refresh}"
                                         update="@widgetVar(optionBlock)" />
                        <p:panel styleClass="panelLayoutBlock" rendered="#{DataversePage.editMode == 'INFO'}"  widgetVar="optionBlock">

                            <style type="text/css">
                                /*.metadata-blocks-default input:focus {outline:1px dotted red;}*/
                                /*.metadata-blocks-default .ui-chkbox-icon {width:18px; height:18px; outline: -webkit-focus-ring-color auto 5px;}*/
                                div.ui-state-focus span.ui-chkbox-icon {outline: -webkit-focus-ring-color auto 5px;}
                            </style>

                            <div class="row form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label" for="mdbSelect">#{bundle['dataverse.metadataElements']}</label>
                                    <div class="col-sm-9">
                                        <p style="display:block; margin-bottom:.5em;" class="text-primary"><span class="glyphicon glyphicon-info-sign"></span> #{bundle['dataverse.metadataElements.tip']}</p>

                                        <p:selectBooleanCheckbox tabindex="7" styleClass="metadata-blocks-default" rendered="#{DataversePage.dataverse.owner != null}" 
                                                                 value="#{DataversePage.inheritMetadataBlockFromParent}" itemLabel="#{bundle['dataverse.metadataElements.from.tip']}">
                                            <p:ajax update="@widgetVar(optionBlock)" listener="#{DataversePage.editMetadataBlocks}"/>
                                        </p:selectBooleanCheckbox>

                                        <ui:repeat value="#{DataversePage.allMetadataBlocks}"  var="mdb">
                                            <ui:fragment rendered="#{mdb.required }">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" jsf:itemValue="#{mdb}" id="#{mdb.idString}" jsf:value="#{mdb.selected}"
                                                               name="mdbSelectRequired" disabled="disabled" checked="checked" />
                                                        <h:outputText value="#{mdb.displayName}#{mdb.required ? bundle['dataverse.field.required']: bundle['dataverse.field.example1'].concat(DataversePage.getMetadataBlockPreview(mdb,3)).concat(bundle['dataverse.field.example2'])}"/>
                                                    </label>
                                                </div>
                                                <p:commandLink style="display:block;" id="showDSFTRequired" rendered="#{!mdb.showDatasetFieldTypes and (mdb.selected or mdb.required) and !DataversePage.openMetadataBlock and !DataversePage.inheritMetadataBlockFromParent}"
                                                               actionListener="#{DataversePage.showDatasetFieldTypes(mdb.id)}">
                                                    <p:ajax update="@widgetVar(optionBlock)" listener="#{DataversePage.showDatasetFieldTypes(mdb.id)}" />
                                                    <h:outputText value="#{bundle['dataverse.field.set.tip']}" />
                                                </p:commandLink>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!mdb.required and DataversePage.inheritMetadataBlockFromParent}">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" jsf:itemValue="#{mdb}" id="#{mdb.idString}" jsf:value="#{mdb.selected}"
                                                               name="mdbSelectRequiredInherited" disabled="disabled">
                                                            <p:ajax update="@widgetVar(optionBlock)" />
                                                            <h:outputText value="#{mdb.displayName}#{mdb.required ? bundle['dataverse.field.required']: bundle['dataverse.field.example1'].concat(DataversePage.getMetadataBlockPreview(mdb,3)).concat(bundle['dataverse.field.example2'])}"/>
                                                        </input>
                                                    </label>
                                                </div>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!mdb.required and !DataversePage.inheritMetadataBlockFromParent}">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" jsf:itemValue="#{mdb}" id="#{mdb.idString}" jsf:value="#{mdb.selected}"
                                                               name="mdbSelectOptional">
                                                            <p:ajax update="@widgetVar(optionBlock)" />
                                                            <h:outputText value="#{mdb.displayName}#{mdb.required ? bundle['dataverse.field.required']: ''}" />
                                                        </input>
                                                    </label>
                                                    <!--<p class="help-block">
                                                        Examples: #{DataversePage.getMetadataBlockPreview(mdb,3)} 
                                                    </p>-->
                                                    <p:commandLink style="display:block;" id="showDSFT" rendered="#{!mdb.showDatasetFieldTypes and (mdb.selected or mdb.required) and !DataversePage.openMetadataBlock}"
                                                                   actionListener="#{DataversePage.showDatasetFieldTypes(mdb.id)}">
                                                        <p:ajax update="@widgetVar(optionBlock)" listener="#{DataversePage.showDatasetFieldTypes(mdb.id)}" />
                                                        <h:outputText value="#{bundle['dataverse.field.set.tip']}" />
                                                    </p:commandLink>
                                                </div>
                                            </ui:fragment>

                                            <p:commandLink style="padding-left: 20px;" id="hideDSFT" actionListener="#{DataversePage.hideDatasetFieldTypes(mdb.id)}" rendered="#{mdb.showDatasetFieldTypes and (mdb.selected or mdb.required)}">
                                                <h:outputText value="#{bundle.close}" />
                                                <p:ajax update="@widgetVar(optionBlock)" listener="#{DataversePage.hideDatasetFieldTypes(mdb.id)}" />
                                            </p:commandLink>
                                            <ui:fragment rendered="#{mdb.showDatasetFieldTypes}">
                                                <div class="panel panel-default" style="width:70%;margin-left:60px;">
                                                    <div class="panel-body" style="max-height:400px;overflow-y:scroll;">
                                                        <table id="metadataFieldOptions" class="table table-striped">
                                                            <tbody>
                                                                <ui:repeat value="#{mdb.datasetFieldTypes}" var="dsft">                                                                
                                                                    <tr>                                                               
                                                                        <td>
                                                                            <p:selectBooleanCheckbox rendered="#{!dsft.hasParent}" value="#{dsft.include}" itemLabel="#{dsft.displayName}"
                                                                                                     disabled="#{!dsft.hasParent and (dsft.hasRequiredChildren or dsft.required) }">
                                                                                <p:ajax  update="@widgetVar(OptButton#{dsft.id})"  listener="#{DataversePage.updateInclude(mdb.id, dsft.id)}"   />
                                                                            </p:selectBooleanCheckbox> 
                                                                            <ui:fragment rendered="#{dsft.hasParent}">
                                                                                <div class="checkbox">
                                                                                    <label>
                                                                                        <h:outputText value="#{dsft.displayName}"/>
                                                                                    </label>
                                                                                </div>
                                                                            </ui:fragment>
                                                                        </td>
                                                                        <td>  

                                                                            <p:selectOneRadio id="OptionsRadio#{dsft.id}" value="#{dsft.requiredDV}" widgetVar="OptButton#{dsft.id}" 
                                                                                              rendered="#{!dsft.hasChildren and !((!dsft.hasChildren  and dsft.required) or (dsft.hasChildren  and dsft.hasRequiredChildren))}">
                                                                                <f:selectItems value="#{dsft.optionSelectItems}"/>
                                                                                <p:ajax update="@widgetVar(OptButton#{dsft.id})"   />
                                                                            </p:selectOneRadio>

                                                                            <ui:fragment rendered="#{(!dsft.hasChildren  and dsft.required) or (dsft.hasChildren  and dsft.hasRequiredChildren)}">
                                                                                #{bundle['dataverse.field.requiredByDataverse']}
                                                                            </ui:fragment>
                                                                        </td>                                                                  
                                                                    </tr>                                                               
                                                                </ui:repeat>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </ui:fragment>
                                        </ui:repeat>
                                    </div>
                                </div>
                            </div>
                        </p:panel>
                        <p:panel id="editFacets" styleClass="panelLayoutBlock" rendered="#{DataversePage.editMode == 'INFO'}" widgetVar="editFacets">
                            <div class="row form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label" for="facetPickListCreate">#{bundle['dataverse.facetPickList.text']}</label>
                                    <div class="col-sm-9">
                                        <p style="display:block; margin-bottom:.5em;" class="text-primary"><span class="glyphicon glyphicon-info-sign"></span> #{bundle['dataverse.facetPickList.tip']}</p>

                                        <p:selectBooleanCheckbox tabindex="8" styleClass="facet-category-default" rendered="#{DataversePage.dataverse.owner != null}" 
                                                                 value="#{DataversePage.inheritFacetFromParent}" itemLabel="#{bundle['dataverse.facetPickList.facersFromHost.text']}">
                                            <p:ajax update="editFacets" listener="#{DataversePage.editFacets}"/>
                                        </p:selectBooleanCheckbox>

                                        <p:pickList id="facetPickListCreate" value="#{DataversePage.facets}" var="facet" converter="facetConverter"
                                                    itemLabel="#{facet.displayName}" itemValue="#{facet}"
                                                    disabled ="#{!DataversePage.dataverse.facetRoot and DataversePage.dataverse.owner != null }"
                                                    rendered="true"/>
                                    </div>
                                </div>
                            </div>
                        </p:panel>

                        <!-- Description Panel / View Mode -->
                        <ui:fragment rendered="#{empty DataversePage.editMode}">

                            <div id="actionButtonBlock" class="clearfix" style="margin-bottom:1em;">
                                <!-- Edit Button -->
                                <ui:fragment rendered="#{dataverseSession.user.authenticated and
                                                         permissionServiceBean.on(DataversePage.dataverse).canIssueCommand('UpdateDataverseCommand')}">
                                    <div class="pull-right" style="margin-left:1em;">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                                <span class="glyphicon glyphicon-pencil"/> #{bundle['dataverse.edit']} <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu pull-right text-left" role="menu">
                                                <li>
                                                    <div style="padding:.5em 1em .25em 1em; overflow:hidden; width:400px;">
                                                        <div style="width:48px; float:left; margin:4px 12px 6px 0;">
                                                            <img src="/resources/images/icon_dataverse.png" style="width:48px;" border="0" alt="#{bundle.dataverse}"/>
                                                        </div>
                                                        <div style="float:left; width:300px;">
                                                            <div style="font-weight:bold;">#{DataversePage.dataverse.name} #{bundle.dataverse} <h:outputText value=" (#{DataversePage.dataverse.affiliation})" rendered="#{!empty DataversePage.dataverse.affiliation}"/></div>
                                                            <div style="color:#777;">#{DataversePage.dataverse.alias}</div>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="divider" role="presentation"></li>
                                                <li>
                                                    <p:commandLink id="editInfo" actionListener="#{DataversePage.edit('INFO')}" update="@form" oncomplete="javascript:post_edit_dv_general_info();initPopover();">
                                                        <h:outputText value="#{bundle['dataverse.option.generalInfo']}" />
                                                    </p:commandLink>
                                                </li>
                                                <li>
                                                    <h:link outcome="ThemeAndWidgets"   id="themeWidgetsOpts" >
                                                        <f:param name="id" value="#{DataversePage.dataverse.id}" />
                                                        <h:outputText value="#{bundle['dataverse.option.themeAndWidgets']}" />
                                                    </h:link>
                                                </li>
                                                <ui:fragment rendered="#{!empty DataversePage.featuredDataverses.source or !empty DataversePage.featuredDataverses.target}">
                                                    <li>
                                                        <p:commandLink id="browseOpts" onclick="browseOptsForm.show()">
                                                            <h:outputText value="#{bundle['dataverse.option.featuredDataverse']}" />
                                                        </p:commandLink>
                                                    </li>
                                                </ui:fragment>
                                                <li>
                                                    <h:link id="managePermissions" styleClass="ui-commandlink ui-widget" outcome="permissions-manage">
                                                        <h:outputText value="#{bundle['dataverse.option.permissions']}" />
                                                        <f:param name="id" value="#{DataversePage.dataverse.id}" />
                                                    </h:link>
                                                </li>                                            
                                                <li>
                                                    <h:link id="manageTemplates" styleClass="ui-commandlink ui-widget" outcome="manage-templates">
                                                        <h:outputText value="#{bundle['dataverse.option.datasetTemplates']}" />
                                                        <f:param name="dataverseId" value="#{DataversePage.dataverse.id}" />
                                                    </h:link>
                                                </li>
                                                <li>
                                                    <h:link id="manageGuestbooks" styleClass="ui-commandlink ui-widget" outcome="manage-guestbooks">
                                                        <h:outputText value="#{bundle['dataverse.option.datasetGuestbooks']}" />
                                                        <f:param name="dataverseId" value="#{DataversePage.dataverse.id}" />
                                                    </h:link>
                                                </li>
                                                <ui:fragment rendered="#{DataversePage.isEmptyDataverse() and !(DataversePage.dataverse.owner == null)
                                                                         and permissionServiceBean.on(DataversePage.dataverse).canIssueCommand('DeleteDataverseCommand')}">
                                                    <li class="divider"></li>
                                                    <li>
                                                        <p:commandLink id="deleteDataset" onclick="deleteConfirmation.show()">
                                                            <h:outputText value="#{bundle['dataverse.option.deleteDataverse']}" />
                                                        </p:commandLink>
                                                    </li>
                                                </ui:fragment>
                                            </ul>
                                        </div>
                                    </div>
                                </ui:fragment>
                                <!-- Release Button -->
                                <ui:fragment rendered="#{dataverseSession.user.authenticated and
                                                         permissionServiceBean.on(DataversePage.dataverse).canIssueCommand('PublishDataverseCommand')}">
                                    <div style="float:right; margin-left:1em;">
                                        <ui:fragment rendered="#{!DataversePage.dataverse.released and (empty DataversePage.dataverse.owner or DataversePage.dataverse.owner.released)}">
                                            <button type="button" class="btn btn-default" onclick="confirmation.show()">
                                                <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataverse.publish']}
                                            </button>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{!DataversePage.dataverse.released and (!empty DataversePage.dataverse.owner and !DataversePage.dataverse.owner.released)}">
                                            <button type="button" class="btn btn-default" onclick="mayNotRelease.show()">
                                                <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataverse.publish']}
                                            </button>
                                        </ui:fragment>
                                    </div>
                                </ui:fragment>
                                <ui:fragment rendered="true">
                                    <div style="float:right;">
                                        <button type="button" class="btn btn-default" onclick="contactForm.show()">
                                            <span class="glyphicon glyphicon-envelope" style="margin-right:.3em;"/> #{bundle['dataverse.contact']}
                                        </button>
                                    </div>
                                </ui:fragment>
                                <p:confirmDialog message="#{bundle['dataverse.email.tip']}" header="#{bundle['dataverse.contact']}" widgetVar="contact_confirmation">
                                </p:confirmDialog>
                            </div>

                            <ui:fragment rendered="#{SearchIncludeFragment.filterQueries.size() == 0 and SearchIncludeFragment.mode != SearchIncludeFragment.searchModeString}">
                                <ui:fragment rendered="#{!empty DataversePage.dataverse.description}">
                                    <div id="dataverseDesc" style="margin-bottom:1em;">
                                        <h:outputText value="#{DataversePage.dataverse.description}"/>
                                    </div>
                                </ui:fragment>
                                <ui:fragment rendered="#{DataversePage.dataverse.displayFeatured or DataversePage.dataverse.displayByType}">
                                    <div id="carouselBlocksWrapper" style="border-bottom:1px solid #ddd; margin-bottom:1em;">
                                        <ui:fragment rendered="#{DataversePage.dataverse.displayFeatured and (!empty DataversePage.carouselFeaturedDataverses)}">
                                            <div id="featuredDataversesBlock" style="overflow: hidden; padding-top:.5em; border-top:1px solid #ddd;">
                                                <div class="clearfix"><strong>#{bundle['dataverse.option.featuredDataverse']}</strong></div>
                                                <div class="customNavigation" style="width:4%;float:left;padding:28px 0;">
                                                    <a class="btn prev1" title="#{bundle['dataverse.page.pre']}"><span class="glyphicon glyphicon-chevron-left" style="color:#999999;font-size:2em;"></span></a>
                                                </div>
                                                <div id="featuredDataversesList" class="owl-carousel owl-theme" style="width:90%;float:left;">
                                                    <ui:repeat value="#{DataversePage.carouselFeaturedDataverses}" var="dv" varStatus="status">
                                                        <div class="item" style="min-height:80px;">
                                                            <ui:fragment rendered="#{empty dv.dataverseTheme.logo}">
                                                                <a href="/dataverse/#{dv.alias}" title="#{dv.name} #{bundle.dataverse}" style="display:block;">
                                                                    <img src="/resources/images/icon_dataverse.png" style="height:60px;" alt="#{dv.name} #{bundle.dataverse}"/>
                                                                </a>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{!empty dv.dataverseTheme.logo and dv.dataverseTheme.logoFormat == 'SQUARE'}">
                                                                <a href="/dataverse/#{dv.alias}" title="#{dv.name} #{bundle.dataverse}" style="display:block;">
                                                                    <img src="/logos/#{dv.logoOwnerId}/#{dv.dataverseTheme.logo}" style="max-width:60px;max-height:60px;" alt="#{dv.name} #{bundle.dataverse}"/>
                                                                </a>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{!empty dv.dataverseTheme.logo and dv.dataverseTheme.logoFormat == 'RECTANGLE'}">
                                                                <a href="/dataverse/#{dv.alias}" title="#{dv.name} #{bundle.dataverse}" style="display:block;">
                                                                    <img src="/logos/#{dv.logoOwnerId}/#{dv.dataverseTheme.logo}" style="max-width:210px;max-height:60px;" alt="#{dv.name} #{bundle.dataverse}"/>
                                                                </a>
                                                            </ui:fragment>
                                                            <a href="/dataverse/#{dv.alias}" title="#{dv.name} #{bundle.dataverse}" style="display:block;">
                                                                <h:outputText value="#{dv.name} #{bundle.dataverse}"/>
                                                            </a>
                                                        </div>
                                                    </ui:repeat>
                                                </div>
                                                <div class="customNavigation" style="width:4%;float:left;padding:28px 0;">
                                                    <a class="btn next1" title="#{bundle['dataverse.page.next']}"><span class="glyphicon glyphicon-chevron-right" style="color:#999999;font-size:2em;"></span></a>
                                                </div>
                                            </div>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{DataversePage.dataverse.displayByType}">
                                            <div id="categoryDataversesBlock" style="overflow: hidden; border-top:1px solid #ddd; padding-top:.5em;">
                                                <div class="clearfix"><strong>#{bundle['dataverse.byCategory']}</strong></div>
                                                <div class="customNavigation" style="width:4%;float:left;padding:28px 0;">
                                                    <a class="btn prev2" title="#{bundle['dataverse.page.pre']}"><span class="glyphicon glyphicon-chevron-left" style="color:#999999;font-size:2em;"></span></a>
                                                </div>
                                                <div id="categoryDataversesList" class="owl-carousel owl-theme" style="width:90%;float:left;">
                                                    <div class="item"><span class="glyphicon glyphicon-user" style="font-size:2.5em;"></span><br/>#{bundle['dataverse.type.selectTab.researchers']}</div>
                                                    <div class="item"><span class="glyphicon glyphicon-film" style="font-size:2.5em;"></span><br/>#{bundle['dataverse.type.selectTab.researchProjects']}</div>
                                                    <div class="item"><span class="glyphicon glyphicon-book" style="font-size:2.5em;"></span><br/>#{bundle['dataverse.type.selectTab.journals']}</div>
                                                    <div class="item"><span class="glyphicon glyphicon-home" style="font-size:2.5em;"></span><br/>#{bundle['dataverse.type.selectTab.organizationsAndInsitutions']}</div>
                                                    <div class="item"><span class="glyphicon glyphicon-tree-conifer" style="font-size:2.5em;"></span><br/>#{bundle['dataverse.type.selectTab.teachingCourses']}</div>
                                                </div>
                                                <div class="customNavigation" style="width:4%;float:left;padding:28px 0;">
                                                    <a class="btn next2" title="#{bundle['dataverse.page.next']}"><span class="glyphicon glyphicon-chevron-right" style="color:#999999;font-size:2em;"></span></a>
                                                </div>
                                            </div>
                                        </ui:fragment>
                                    </div>
                                </ui:fragment>
                            </ui:fragment>
                        </ui:fragment>

                        <!-- Featured Dataverses Popup -->
                        <p:dialog header="#{bundle['dataverse.option.featuredDataverse']}" widgetVar="browseOptsForm" modal="true">
                            <!--<div class="form-group">
                                <p:selectBooleanCheckbox value="    #    {DataversePage.dataverse.displayByType}"
                                                     itemLabel="Display 'Dataverse by Category' Carousel on Front Page"/>
                            </div>-->
                            <div class="form-group">
                                <p:selectBooleanCheckbox value="#{DataversePage.dataverse.displayFeatured}"
                                                         itemLabel="#{bundle['dataverse.displayFeatured']}"/>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputFile">#{bundle['dataverse.option.featuredDataverse']}</label>
                                <p class="help-block">#{bundle['dataverse.selectToFeature']}</p>
                                <p:pickList id="featuredDataverseList" value="#{DataversePage.featuredDataverses}" var="featureddataverse"
                                            itemLabel="#{featureddataverse.name}"
                                            itemValue="#{featureddataverse}" converter="dataverseConverter"
                                            showSourceFilter="true" showTargetFilter="true" />
                            </div>
                            <h:commandButton type="submit" action="#{DataversePage.saveFeature()}" class="btn btn-success" value="Save Changes"/>
                            <button type="button" class="btn btn-default" onclick="browseOptsForm.hide()" value="Cancel">#{bundle.cancel}</button>
                        </p:dialog>

                        <ui:include src="rolesAndPermissionsFragment.xhtml"/>

                        <!-- Publish Confirmation Popup -->
                        <p:confirmDialog message="#{bundle['dataverse.publish.tip']}" header="#{bundle['dataverse.publish']}" widgetVar="confirmation">
                            <p:commandButton value="#{bundle.continue}" onclick="confirmation.hide()" action="#{DataversePage.releaseDataverse}">
                            </p:commandButton>
                            <p:commandButton value="#{bundle.cancel}" onclick="confirmation.hide();" type="button" />
                        </p:confirmDialog>
                        <p:confirmDialog message="#{bundle['dataverse.publish.failed.tip']}" header="#{bundle['dataverse.publish.failed']}" widgetVar="mayNotRelease">
                        </p:confirmDialog>
                        <p:confirmDialog message="#{bundle['dataverse.delete.tip']}" header="#{bundle['dataverse.delete']}" widgetVar="deleteConfirmation">
                            <p:commandButton value="#{bundle.continue}" onclick="deleteConfirmation.hide()" action="#{DataversePage.deleteDataverse}">
                            </p:commandButton>
                            <p:commandButton value="#{bundle.cancel}" onclick="deleteConfirmation.hide();" type="button" />
                        </p:confirmDialog>

                        <!-- Dataverse Theme Panel -->
                        <ui:fragment rendered="#{DataversePage.editMode == 'THEME'}">
                            <p:panelGrid columns="3">
                                <h:outputLabel value="#{bundle['dataverse.theme.logo']}"/>
                                <p:inputText id="logo" value="#{DataversePage.dataverse.dataverseTheme.logo}"/>
                                <p:message for="logo" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.logoformat']}"/>
                                <p:selectOneRadio id="logoFormat" value="#{DataversePage.dataverse.dataverseTheme.logoFormat}">
                                    <f:selectItem itemLabel="#{bundle['dataverse.theme.logo.format.selectTab.square']}" itemValue="SQUARE"/>
                                    <f:selectItem itemLabel="#{bundle['dataverse.theme.logo.format.selectTab.rectangle']}" itemValue="RECTANGLE"/>
                                </p:selectOneRadio>
                                <p:message for="logoFormat" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.logo.alignment']}"/>
                                <p:selectOneMenu id="logoAlignment" value="#{DataversePage.dataverse.dataverseTheme.logoAlignment}">
                                    <f:selectItem id="left" itemLabel="#{bundle['dataverse.theme.logo.alignment.selectTab.left']}" itemValue="LEFT" />
                                    <f:selectItem id="center" itemLabel="#{bundle['dataverse.theme.logo.alignment.selectTab.center']}" itemValue="CENTER" />
                                    <f:selectItem id="right" itemLabel="#{bundle['dataverse.theme.logo.alignment.selectTab.right']}" itemValue="RIGHT" />
                                </p:selectOneMenu>
                                <p:message for="logoFormat" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.logo.backColor']}"/>
                                <p:inputText id="logoBackgroundColor" value="#{DataversePage.dataverse.dataverseTheme.logoBackgroundColor}"/>
                                <p:message for="logoBackgroundColor" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.tagline']}"/>
                                <p:inputText id="tagline" value="#{DataversePage.dataverse.dataverseTheme.tagline}"/>
                                <p:message for="tagline" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.linkUrl']}"/>
                                <p:inputText id="linkUrl" value="#{DataversePage.dataverse.dataverseTheme.linkUrl}"/>
                                <p:message for="linkUrl" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.linkTxt']}"/>
                                <p:inputText id="linkText" value="#{DataversePage.dataverse.dataverseTheme.linkText}"/>
                                <p:message for="linkText" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.linkColor']}"/>
                                <p:inputText id="linkColor" value="#{DataversePage.dataverse.dataverseTheme.linkColor}"/>
                                <p:message for="linkColor" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.txtColor']}"/>
                                <p:inputText id="textColor" value="#{DataversePage.dataverse.dataverseTheme.textColor}"/>
                                <p:message for="textColor" display="text"/>
                                <h:outputLabel value="#{bundle['dataverse.theme.backColor']}"/>
                                <p:inputText id="backgroundColor" value="#{DataversePage.dataverse.dataverseTheme.backgroundColor}"/>
                                <p:message for="backgroundColor" display="text"/>
                            </p:panelGrid>
                        </ui:fragment>

                        <!-- Save / Cancel Button Panel -->
                        <p:panel styleClass="panelLayoutButtonBlock" rendered="#{!empty DataversePage.editMode}">
                            <p:commandButton id="save" tabindex="9" value="#{DataversePage.dataverse.id == null ? bundle.createDataverse : bundle.saveChanges}" action="#{DataversePage.save}" update="@all"/>
                        <p:commandButton id="cancel" tabindex="10" value="#{bundle.cancel}" actionListener="#{DataversePage.cancel}" process="@this" update="@form" rendered="#{DataversePage.dataverse.id != null}" oncomplete="javascript:post_cancel_edit_dv()" />
                        <p:button tabindex="10" value="#{bundle.cancel}" outcome="/dataverse.xhtml?id=#{DataversePage.ownerId}" rendered="#{DataversePage.dataverse.id == null and DataversePage.ownerId != null}"/>
                        </p:panel>
                </h:form>

                <!-- Content Panel -->
                <ui:fragment rendered="#{empty DataversePage.editMode}">
                    <ui:include src="search-include-fragment.xhtml">
                        <ui:param name="showAdvancedSearchLink" value="true"/>
                        <ui:param name="showFacets" value="true"/>
                        <ui:param name="showSearch" value="true"/>
                    </ui:include>
                </ui:fragment>

                <!-- Dialog Contact Form -->
                <p:dialog header="#{bundle['dataverse.contact']}" widgetVar="contactForm" modal="true" style="min-width:500px;">
                    <h:form class="form-horizontal">
                        <div class="form-group">
                            <label for="messageTo" class="col-sm-2 control-label">#{bundle['feedback.to']}</label>
                            <div class="col-sm-10">
                                <p id="messageTo" class="form-control-static">#{DataversePage.dataverse.displayName} #{bundle['feedback.contact']}</p>
                            </div>
                        </div>
                        <ui:fragment rendered="#{sendFeedbackDialog.isLoggedIn()}">
                            <div class="form-group">
                                <label for="userEmailStatic" class="col-sm-2 control-label">#{bundle['feedback.from']}</label>
                                <div class="col-sm-10">
                                    <p id="userEmailStatic" class="form-control-static">#{sendFeedbackDialog.loggedInUserEmail()}</p>
                                </div>
                            </div>
                        </ui:fragment>
                        <ui:fragment rendered="#{!sendFeedbackDialog.isLoggedIn()}">
                            <div class="form-group">
                                <label for="userEmail" class="col-sm-2 control-label">#{bundle['feedback.from']}</label>
                                <div class="col-sm-10">
                                    <h:inputText id="userEmail" styleClass="form-control" size="30" value="#{sendFeedbackDialog.userEmail}"/>
                                </div>
                            </div>
                        </ui:fragment>
                        <div class="form-group">
                            <label for="messageSubject" class="col-sm-2 control-label">#{bundle['feedback.subject']}</label>
                            <div class="col-sm-10">
                                <select id="messageSubject" class="form-control">
                                    <option>#{bundle['feedback.subject.selectTab.top']}</option>
                                    <option>#{bundle['feedback.subject.selectTab.support']}</option>
                                    <option>#{bundle['feedback.subject.selectTab.dataIssue']}</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="userMessage" class="col-sm-2 control-label">#{bundle['feedback.msg']}</label>
                            <div class="col-sm-10">
                                <h:inputTextarea id="userMessage" styleClass="form-control" rows="10" value="#{sendFeedbackDialog.userMessage}"/>
                            </div>
                        </div>

                        <h:commandButton type="submit" action="#{sendFeedbackDialog.sendMessage}" class="btn btn-success" value="#{bundle['feedback.send']}"/>
                        <button type="button" class="btn btn-default" onclick="contactForm.hide()" value="Cancel">#{bundle.cancel}</button>
                    </h:form>
                </p:dialog>

                <script type="text/javascript">
                    //<![CDATA[
                    $(document).ready(function () {
                        initPopover();
                        initCarousel();
                    });

                    function initCarousel() {
                        var owl1 = $("#featuredDataversesList");
                        var owl2 = $("#categoryDataversesList");

                        owl1.owlCarousel({
                            pagination: false,
                            navigation: false,
                            // navigationText: ["<span class=\"glyphicon glyphicon-chevron-left\" style=\"color:#999999;font-size:2em;\"></span>","<span class=\"glyphicon glyphicon-chevron-right\" style=\"color:#999999;font-size:2em;\"></span>"],
                            items: 4, //10 items above 1000px browser width
                            itemsDesktop: [1140, 4], //5 items between 1000px and 901px
                            itemsDesktopSmall: [940, 3], // betweem 900px and 601px
                            itemsTablet: [720, 2], //2 items between 600 and 0
                            itemsMobile: false // itemsMobile disabled - inherit from itemsTablet option
                        });
                        if (owl1.find('div.owl-item').length > 4) {
                            // Custom Navigation Events
                            $(".next1").click(function () {
                                owl1.trigger('owl.next');
                            });
                            $(".prev1").click(function () {
                                owl1.trigger('owl.prev');
                            });
                        } else {
                            $("#featuredDataversesBlock .customNavigation a.btn").hide();
                        }

                        owl2.owlCarousel({
                            pagination: false,
                            navigation: false,
                            // navigationText: ["<span class=\"glyphicon glyphicon-chevron-left\" style=\"color:#999999;font-size:2em;\"></span>","<span class=\"glyphicon glyphicon-chevron-right\" style=\"color:#999999;font-size:2em;\"></span>"],
                            items: 4, //10 items above 1000px browser width
                            itemsDesktop: [1140, 4], //5 items between 1000px and 901px
                            itemsDesktopSmall: [940, 3], // betweem 900px and 601px
                            itemsTablet: [720, 2], //2 items between 600 and 0
                            itemsMobile: false // itemsMobile disabled - inherit from itemsTablet option
                        });
                        if (owl2.find('div.owl-item').length > 4) {
                            // Custom Navigation Events
                            $(".next2").click(function () {
                                owl2.trigger('owl.next');
                            });
                            $(".prev2").click(function () {
                                owl2.trigger('owl.prev');
                            });
                        } else {
                            $("#categoryDataversesBlock .customNavigation a.btn").hide();
                        }
                    }

                    function initPopover() {
                        $('#content label.control-label[data-toggle="popover"]').popover();
                        $('body').on('click', function (e) {
                            $('label[data-toggle="popover"]').each(function () {
                                //the 'is' for buttons that trigger popups
                                //the 'has' for icons within a button that triggers a popup
                                if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                                    $(this).popover('hide');
                                }
                            });
                        });
                    }

                    function updateInclude() {
                        $('button[id$="hiddenRefresh"]').trigger('click');
                    }
                    //]]>
                </script>

            </ui:define>
        </ui:composition>
    </h:body>
</html>
