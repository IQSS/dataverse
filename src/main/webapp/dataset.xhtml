<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
    </h:head>

    <h:body>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{DatasetPage.editMode == 'CREATE' ? bundle['dataset.pageTitle'] : DatasetPage.workingVersion.title} - #{DatasetPage.dataset.owner.name} #{bundle.dataverse}"/>
            <ui:param name="dataverse" value="#{DatasetPage.dataset.owner}"/>
            <ui:param name="dataset" value="#{DatasetPage.dataset}"/>
            <ui:param name="version" value="#{DatasetPage.workingVersion}"/>
            <ui:param name="showBreadcrumbs" value="#{empty DatasetPage.editMode}"/>
            <ui:param name="showMessagePanel" value="#{true}"/>
            <ui:define name="body">
                <script type="text/javascript" src="/resources/js/dropins.js" id="dropboxjs" data-app-key="#{DatasetPage.dropBoxKey}"/>
                <script type="text/javascript">

                    function openDialog() {
                        details.show();
                    }
                    function openCompareTwo() {
                        compareTwo.show();
                    }
                    function testCheckBoxes() {
                        var count = versionsTable.getSelectedRowsCount();
                        if (count !== 2) {
                            compareTwo.show();
                        } else {
                            $('button[id$="compareVersions"]').trigger('click');
                        }
                    }

                    function updateTemplate() {
                        $('button[id$="updateTemplate"]').trigger('click');
                    }

                    function registerDataset() {
                        $('button[id$="registerDataset"]').trigger('click');
                    }

                    function checkFilesSelected() {
                        var count = filesTable.getSelectedRowsCount();
                        if (count > 0) {
                            deleteFileConfirmation.show();
                        } else {
                            $('button[id$="datasetSave"]').trigger('click');
                        }
                    }

                    function updateHiddenReason(textArea) {
                        $('input[id$="hiddenReasonInput"]').val(textArea.value);
                    }

                    function testDeaccessionVersionSelection(testVersion) {
                        var deaccessionText = $('input[id$="hiddenReasonInput"]').val();
                        var urlEntry = $('input[id$="forwardURLForDeaccession"]').val();
                        ;
                        var valid = true;
                        if (testVersion === true) {
                            var count = versionDeaccessionTable.getSelectedRowsCount();
                        }

                        if (validateURL(urlEntry) === false) {
                            valid = false;
                            enterForwardUrl.show();
                        }
                        if (valid === true) {
                            if ($("select[id$='reasonOptions'] option:selected").val() === '7') {
                                if (deaccessionText === '') {
                                    valid = false;
                                    enterOtherReason.show();
                                }
                            }
                        }
                        if (deaccessionText.length >= 1001) {
                            valid = false;
                            reasonTooManyCharacters.show();
                        }
                        if (valid === true) {
                            if ($("select[id$='reasonOptions'] option:selected").val() === '0') {
                                valid = false;
                                selectDeaccessionReason.show();
                            }
                        }
                        if (valid === true) {
                            if (testVersion === false) {
                                deaccessionAllConfirmation.show();
                            } else {
                                if (count === 0) {
                                    selectDeaccessionVersion.show();
                                } else {
                                    deaccessionConfirmation.show();
                                }
                            }
                        }
                    }

                    function validateURL(textval) {
                        if (textval === '') {
                            return true;
                        }
                        var urlregex = new RegExp("^(http|https|ftp)\://([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&amp;%\$\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\:[0-9]+)*(/($|[a-zA-Z0-9\.\,\?\'\\\+&amp;%\$#\=~_\-]+))*$");
                        return urlregex.test(textval);
                    }

                    function openDropboxChooser() {
                        options = {
                            // Required. Called when a user selects an item in the Chooser.
                            success: function (files) {
                                // Pass the JSON-ized output of the Chooser to the backing bean,
                                // via a hidden input field:
                                $('input[id$="dropBoxSelectionInput"]').val(JSON.stringify(files));
                                //alert(JSON.stringify(files));
                                // Trigger the upload processing method in the backing
                                // bean, via an invisible commandButton:
                                $('button[id$="dropBoxButton"]').trigger('click');

                            },
                            linkType: "direct",
                            multiselect: true,
                        };
                        Dropbox.choose(options);
                    }
                </script>

                <f:metadata>
                    <f:viewParam name="id" value="#{DatasetPage.dataset.id}"/>
                    <f:viewParam name="ownerId" value="#{DatasetPage.ownerId}"/>
                    <f:viewParam name="versionId" value="#{DatasetPage.versionId}"/>
                    <f:viewParam name="globalId" value="#{DatasetPage.globalId}"/>
                    <f:viewAction action="#{DatasetPage.init}" />
                </f:metadata>

                <h:form id="datasetForm">
                    <!-- Header / Button Panel -->
                    <ui:fragment>
                        <!-- View mode -->
                        <ui:fragment rendered="#{empty DatasetPage.editMode}">
                            <div id="topDatasetBlock">
                                <div id="actionButtonBlock" class="clearfix" style="margin-bottom:.55em;">
                                    <ui:fragment rendered="#{dataverseSession.user.authenticated and empty DatasetPage.editMode
                                                             and ((DatasetPage.workingVersion == DatasetPage.dataset.latestVersion and (DatasetPage.workingVersion.draft or DatasetPage.workingVersion.released))
                                                             or (DatasetPage.workingVersion != DatasetPage.dataset.latestVersion and DatasetPage.dataset.latestVersion.deaccessioned and  DatasetPage.workingVersion == DatasetPage.dataset.releasedVersion))
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand')
                                                             and !DatasetPage.locked}">
                                        <div style="float:right; margin-left:1em;">
                                            <div class="btn-group">
                                                <button type="button" id="editDataSet" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                                    <span class="glyphicon glyphicon-pencil" style="margin-right:.3em;"/> #{bundle['dataset.editBtn']} <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu pull-right" role="menu" style="text-align:left;">
                                                    <li>
                                                        <p:commandLink id="editFiles" actionListener="#{DatasetPage.edit('FILE')}" update="@form" oncomplete="javascript:post_edit_files()">
                                                            <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                            <h:outputText value="#{bundle['dataset.editBtn.itemLabel.upload']}" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink id="editMetadata" actionListener="#{DatasetPage.edit('METADATA')}" update="@form" oncomplete="javascript:post_edit_metadata()">
                                                            <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                            <h:outputText value="#{bundle['dataset.editBtn.itemLabel.metadata']}" />
                                                        </p:commandLink>
                                                    </li>
                                                   <li>
                                                        <p:commandLink id="editLicenseTerms" actionListener="#{DatasetPage.edit('LICENSE')}" update="@form" oncomplete="javascript:post_edit_metadata()">
                                                            <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                            <h:outputText value="#{bundle['dataset.editBtn.itemLabel.terms']}" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <h:link id="managePermissions" styleClass="ui-commandlink ui-widget" outcome="permissions-manage">
                                                            <h:outputText value="#{bundle['dataset.editBtn.itemLabel.permissions']}" />
                                                            <f:param name="id" value="#{DatasetPage.dataset.id}" />
                                                        </h:link>
                                                    </li>
                                                    <ui:fragment rendered="#{!DatasetPage.dataset.released and DatasetPage.dataset.latestVersion.versionState=='DRAFT' and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('DeleteDatasetCommand')}">
                                                        <li class="divider"></li>
                                                        <li>
                                                            <p:commandLink id="deleteDataset" onclick="deleteConfirmation.show()">
                                                                <h:outputText value="#{bundle['dataset.editBtn.itemLabel.deleteDataset']}" />
                                                            </p:commandLink>
                                                        </li>
                                                    </ui:fragment>
                                                    <ui:fragment rendered="#{DatasetPage.dataset.released and DatasetPage.dataset.latestVersion.versionState=='DRAFT' and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('DeleteDatasetCommand')}">
                                                        <li class="divider"></li>
                                                        <li>
                                                            <p:commandLink id="deleteVersion" onclick="deleteVersionConfirmation.show()">
                                                                <h:outputText value="#{bundle['dataset.editBtn.itemLabel.deleteDraft']}" />
                                                            </p:commandLink>
                                                        </li>
                                                    </ui:fragment>
                                                    <ui:fragment rendered="#{DatasetPage.dataset.released and !empty(DatasetPage.releasedVersionTabList) and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('DeleteDatasetCommand')}">
                                                        <li class="divider"></li>
                                                        <li>
                                                            <p:commandLink id="deaccessionDatasetLink" onclick="deaccessionBlock.show()">
                                                                <h:outputText value="#{bundle['dataset.editBtn.itemLabel.deaccession']}" />
                                                            </p:commandLink>
                                                        </li>
                                                    </ui:fragment>
                                                    <!--<li><a href="#" class="ui-commandlink ui-widget" style="pointer-events: none; color: grey;">Permissions</a></li>-->
                                                </ul>
                                            </div>
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{dataverseSession.user.authenticated and empty DatasetPage.editMode
                                                             and DatasetPage.workingVersion == DatasetPage.dataset.latestVersion
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('PublishDatasetCommand')}">
                                        <div style="float:right; margin-left:1em;">
                                            <ui:fragment rendered="#{!DatasetPage.dataset.released and DatasetPage.dataset.globalIdCreateTime == null
                                                                     and DatasetPage.dataset.latestVersion.versionState=='DRAFT'
                                                                     and DatasetPage.dataset.owner.released and !DatasetPage.locked}">
                                                <button type="button" class="btn btn-default" onclick="registerDataset()">
                                                    <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataset.registerBtn']}
                                                </button>
                                                <p:commandButton value="Direct" id="registerDataset"
                                                                 style="display:none"
                                                                 update="@form"
                                                                 action="#{DatasetPage.registerDataset()}">
                                                </p:commandButton>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!DatasetPage.dataset.released and DatasetPage.dataset.globalIdCreateTime != null
                                                                     and DatasetPage.dataset.latestVersion.versionState=='DRAFT'
                                                                     and DatasetPage.dataset.owner.released and !DatasetPage.locked}">
                                                <button type="button" class="btn btn-default" onclick="confirmation.show()">
                                                    <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataset.publishBtn']}
                                                </button>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{DatasetPage.dataset.released and DatasetPage.dataset.latestVersion.versionState=='DRAFT' and DatasetPage.dataset.owner.released and !DatasetPage.locked}">
                                                <button type="button" class="btn btn-default" onclick="releaseDraft.show()">
                                                    <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataset.publishBtn']}
                                                </button>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{DatasetPage.dataset.latestVersion.versionState=='DRAFT' and !DatasetPage.dataset.owner.released and !DatasetPage.locked}">
                                                <button type="button" class="btn btn-default" onclick="mayNotRelease.show()">
                                                    <span class="glyphicon glyphicon-globe" style="margin-right:.3em;"/> #{bundle['dataset.publishBtn']}
                                                </button>
                                            </ui:fragment>
                                        </div>
                                        <p:confirmDialog message="#{bundle['dataset.publish.tip']}" header="#{bundle['dataset.publishBtn']}" widgetVar="confirmation">
                                            <ui:fragment rendered="#{DatasetPage.dataset.globalIdCreateTime == null}">
                                                #{bundle['dataset.unregistered.tip']}
                                            </ui:fragment>
                                            <p:commandButton value="#{bundle.continue}" onclick="confirmation.hide()" action="#{DatasetPage.releaseDataset}">
                                            </p:commandButton>
                                            <p:commandButton value="#{bundle.cancel}" onclick="confirmation.hide()" type="button" />
                                        </p:confirmDialog>
                                        <p:confirmDialog message="#{bundle['dataset.republish.tip']}" header="#{bundle['dataset.publishBtn']}" widgetVar="releaseDraft">
                                            <ui:fragment rendered="#{DatasetPage.dataset.latestVersion.minorUpdate}">
                                                #{bundle['dataset.selectVersionNumber']}
                                                <p:selectOneRadio id="options" value="#{DatasetPage.releaseRadio}">
                                                    <f:selectItem itemLabel="#{bundle['dataset.majorRelease']} (#{DatasetPage.datasetNextMajorVersion})" itemValue="1" />
                                                    <f:selectItem itemLabel="#{bundle['dataset.minorRelease']} (#{DatasetPage.datasetNextMinorVersion})" itemValue="2" />
                                                </p:selectOneRadio>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{!DatasetPage.dataset.latestVersion.minorUpdate}">
                                                <h:outputFormat value="#{bundle['dataset.majorRelease.tip']}">
                                                    <f:param value="#{DatasetPage.datasetNextMajorVersion}"/>
                                                </h:outputFormat>
                                            </ui:fragment>
                                            <p:commandButton value="#{bundle.continue}" onclick="releaseDraft.hide()" action="#{DatasetPage.releaseDraft}">
                                            </p:commandButton>
                                            <p:commandButton value="#{bundle.cancel}" onclick="releaseDraft.hide()" type="button" />
                                        </p:confirmDialog>
                                        <p:confirmDialog message="#{bundle['dataset.mayNotBePublished.tip']}" header="#{bundle['dataset.mayNotBePublished']}" widgetVar="mayNotRelease">
                                        </p:confirmDialog>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{DatasetPage.dataset.latestVersion.draft and DatasetPage.workingVersion != DatasetPage.dataset.latestVersion
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand')}">
                                        <div style="float:right; margin-left:1em;">
                                            <h:outputLink styleClass="btn btn-warning" value="/dataset.xhtml?id=#{DatasetPage.dataset.id}&#38;versionId=#{DatasetPage.dataset.latestVersion.id}">
                                                <h:outputText value="#{bundle['dataset.viewVersion.unpublished']}"/>
                                            </h:outputLink>
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{DatasetPage.dataset.released and DatasetPage.workingVersion != DatasetPage.dataset.releasedVersion
                                                             and !empty(DatasetPage.releasedVersionTabList)}">
                                        <div style="float:right; margin-left:1em;">
                                            <h:outputLink styleClass="btn btn-primary" value="/dataset.xhtml?id=#{DatasetPage.dataset.id}&#38;versionId=#{DatasetPage.dataset.releasedVersion.id}">
                                                <h:outputText value="#{bundle['dataset.viewVersion.published']}"/>
                                            </h:outputLink>
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{empty DatasetPage.editMode}">
                                        <div style="float:right;">
                                            <button type="button" class="btn btn-default" onclick="contact_confirmation.show()">
                                                <span class="glyphicon glyphicon-envelope" style="margin-right:.3em;"/> #{bundle['dataset.email.datasetContactBtn']}
                                            </button>
                                        </div>
                                    </ui:fragment>
                                    <p:confirmDialog message="#{bundle['dataset.email.tip']}" header="#{bundle['dataset.email.datasetContactBtn']}" widgetVar="contact_confirmation">
                                    </p:confirmDialog>
                                </div>
                                <div id="datasetVersionBlock" class="container-fluid">
                                    <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.title.value}">
                                        <div class="row" >
                                            <span id="title">#{DatasetPage.datasetVersionUI.title.value}</span>
                                            <h:outputText value="#{bundle['dataset.versionUI.draft']}" styleClass="label label-warning" rendered="#{DatasetPage.workingVersion.draft}"/>
                                            <h:outputText value="#{bundle['dataset.versionUI.unpublished']}" styleClass="label label-danger" rendered="#{!DatasetPage.dataset.released}"/>
                                            <h:outputText value="#{bundle['dataset.versionUI.deaccessioned']}" styleClass="label label-info" rendered="#{DatasetPage.workingVersion.deaccessioned}"/>
                                        </div>

                                    </ui:fragment>
                                    <ui:fragment rendered="#{!empty DatasetPage.displayCitation}">
                                        <div class="row" >
                                            <div id="citation" class="bg-info col-md-9" style="margin-bottom:.5em;">
                                                <span>#{DatasetPage.displayCitation}</span>
                                                <ui:fragment rendered="#{!DatasetPage.dataset.released}">
                                                    <span class="glyphicon glyphicon-question-sign text-primary" style="cursor:pointer; cursor:hand;" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-original-title="#{bundle['dataset.cite.title.released']}"></span>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{DatasetPage.dataset.released and DatasetPage.workingVersion.draft}">
                                                    <span class="glyphicon glyphicon-question-sign text-primary" style="cursor:pointer; cursor:hand;" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-original-title="#{bundle['dataset.cite.title.draft']}"></span>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{DatasetPage.workingVersion.deaccessioned}">
                                                    <span class="glyphicon glyphicon-question-sign text-primary" style="cursor:pointer; cursor:hand;" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-original-title="#{bundle['dataset.cite.title.deassessioned']}"></span>
                                                </ui:fragment>
                                                <span id="whycitelink" class="bg-warning small"><a href="/guides/Data_Citation/index.html" target="_blank">#{bundle['dataset.cite.whyCite']}</a></span>
                                            </div>
                                            <div class="col-md-3 text-right" style="padding-right:0; margin-bottom:.5em;">
                                                <div class="dropdown">
                                                    <button type="button" id="downloadCitation" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                                        <span class="glyphicon glyphicon-download-alt" style="margin-right:.3em;"/> #{bundle['dataset.cite.downloadBtn']} <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu pull-right" role="menu" style="text-align:left;">
                                                        <li>
                                                            <h:commandLink id="endNoteLink" action="#{DatasetPage.downloadDatasetCitationXML()}" >

                                                                <h:outputText value="#{bundle['dataset.cite.downloadBtn.xml']}" />
                                                            </h:commandLink>
                                                        </li>
                                                        <li>
                                                            <h:commandLink id="risLink" actionListener="#{DatasetPage.downloadDatasetCitationRIS()}">

                                                                <h:outputText value="#{bundle['dataset.cite.downloadBtn.ris']}" />
                                                            </h:commandLink>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ui:fragment>

                                    <ui:fragment rendered="#{DatasetPage.workingVersion.deaccessioned}">
                                        <div class="bg-danger" style="padding:4px;margin-bottom:.5em;">
                                            <p><strong>#{bundle['dataset.deaccession.reason']}</strong> #{DatasetPage.workingVersion.versionNote}</p>
                                            <ui:fragment rendered="#{!empty DatasetPage.workingVersion.archiveNote}">
                                                <p>#{bundle['dataset.beAccessedAt']} <a href="#{DatasetPage.workingVersion.archiveNote}" target="_blank">#{DatasetPage.workingVersion.archiveNote}</a></p>
                                            </ui:fragment>
                                        </div>
                                    </ui:fragment>

                                    <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.description.value and !DatasetPage.workingVersion.deaccessioned}">
                                        <span id="description">#{DatasetPage.datasetVersionUI.description.value}</span>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{!DatasetPage.workingVersion.deaccessioned and (!empty DatasetPage.datasetVersionUI.keyword.value
                                                             or !empty DatasetPage.datasetVersionUI.subject.value or !empty DatasetPage.datasetVersionUI.relPublicationCitation
                                                             or !empty DatasetPage.datasetVersionUI.notes.value)}">
                                        <div id="" class="panel panel-default" style="margin-top:1em;">
                                            <div class="panel-body" style="padding:12px 0;">
                                                <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.keyword.value}">
                                                    <span id="keywords" class="form-group">
                                                        <label class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel" data-original-title="#{DatasetPage.datasetVersionUI.keyword.datasetFieldType.description}" title="">#{DatasetPage.datasetVersionUI.keyword.datasetFieldType.title}</a>
                                                        </label>
                                                        <span class="col-sm-8" style="padding-left:0; padding-right:0;">#{DatasetPage.datasetVersionUI.keyword.displayValue}</span>
                                                    </span>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.subject.value}">
                                                    <span id="subject" class="form-group">
                                                        <label class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel" data-original-title="#{DatasetPage.datasetVersionUI.subject.datasetFieldType.description}" title="">#{DatasetPage.datasetVersionUI.subject.datasetFieldType.title}</a>
                                                        </label>
                                                        <span class="col-sm-8" style="padding-left:0; padding-right:0;">#{DatasetPage.datasetVersionUI.subject.displayValue}</span>
                                                    </span>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.relPublicationCitation}">
                                                    <span id="publication" class="form-group">
                                                        <label class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel" data-original-title="#{DatasetPage.datasetVersionUI.datasetRelPublications.get(0).description}" title="">#{DatasetPage.datasetVersionUI.datasetRelPublications.get(0).title} </a>
                                                        </label>
                                                        <span class="col-sm-8" style="padding-left:0; padding-right:0;">#{DatasetPage.datasetVersionUI.relPublicationCitation}  <a href="#{DatasetPage.datasetVersionUI.relPublicationUrl}" title="#{DatasetPage.datasetVersionUI.relPublicationUrl}" target="_blank">#{DatasetPage.datasetVersionUI.relPublicationId}</a></span>
                                                    </span>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{!empty DatasetPage.datasetVersionUI.notes.value}">
                                                    <span id="note" class="form-group">
                                                        <label class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel" data-original-title="#{DatasetPage.datasetVersionUI.notes.datasetFieldType.description}" title="">#{DatasetPage.datasetVersionUI.notes.datasetFieldType.title}</a>
                                                        </label>
                                                        <span class="col-sm-8" style="padding-left:0; padding-right:0;">#{DatasetPage.datasetVersionUI.notes.value}</span>
                                                    </span>
                                                </ui:fragment>
                                            </div>
                                        </div>
                                    </ui:fragment>
                                </div>
                            </div>
                        </ui:fragment>

                        <!-- Create mode -->
                        <ui:fragment rendered="#{DatasetPage.editMode == 'METADATA' or DatasetPage.editMode == 'CREATE'}">
                            <div class="form-group">
                                <label for="select_HostDataverse" class="col-sm-2 control-label">
                                    <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataverse.host.title']}">#{bundle.hostDataverse}</a>
                                </label>
                                <div class="col-sm-10">

                                    <h:outputText value="#{ DatasetPage.dataset.owner.name }" style="font-weight:bold;"/>
                                    <h:inputHidden value="#{DatasetPage.ownerId}" id="select_HostDataverse" />

                                    <ui:remove><!-- removed for beta -->
                                        <p:selectOneMenu id="select_HostDataverse" value="#{DatasetPage.ownerId}" filter="true" filterMatchMode="startsWith" effect="none">
                                            <f:selectItems value="#{dataverseServiceBean.findAll()}" var="dv" itemLabel="#{dv.name}" itemValue="#{dv.id}"/>
                                        </p:selectOneMenu>
                                    </ui:remove>
                                </div>
                            </div>
                        </ui:fragment>
                        <ui:fragment rendered="#{DatasetPage.editMode == 'CREATE'}">
                            <ui:fragment rendered="#{!empty DatasetPage.dataverseTemplates}">
                                <div class="form-group">
                                    <label for="select_DatasetTemplate" class="col-sm-2 control-label">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataset.manageTemplates.tab.action.btn.view.dialog.datasetTemplate.title']}">#{bundle['dataset.manageTemplates.tab.action.btn.view.dialog.datasetTemplate']}</a>
                                    </label>
                                    <div class="col-sm-10">
                                        <p:selectOneMenu value="#{DatasetPage.selectedTemplate}" onchange="updateTemplate()"
                                                         converter="templateConverter" id="select_DatasetTemplate" styleClass="form-control"
                                                         valueChangeListener="#{DatasetPage.updateSelectedTemplate}">
                                            <f:selectItem itemLabel="#{bundle['dataset.noTemplate.label']}" itemValue="#{null}" />
                                            <f:selectItems value="#{DatasetPage.dataverseTemplates}"
                                                           var="template" itemLabel="#{template.name}" itemValue="#{template}"/>
                                        </p:selectOneMenu>
                                        <p:commandButton value="Direct" id="updateTemplate"
                                                         style="display:none"
                                                         update="@form"
                                                         action="#{DatasetPage.handleChangeButton}">
                                        </p:commandButton>
                                    </div>
                                </div>
                            </ui:fragment>
                            <ui:include src="metadataFragment.xhtml"/>
                        </ui:fragment>
                    </ui:fragment>

                    <!-- Create/Save Dataset Button Panel -->
                    <p:panel styleClass="panelLayoutButtonBlock" style="border-top: 1px solid #dddddd;" rendered="#{DatasetPage.editMode == 'METADATA'}">
                        <p:commandButton id="saveTop" value="#{bundle.saveChanges}" onclick="checkFilesSelected();" />
                        <p:commandButton id="cancelTop" value="#{bundle.cancel}" action="#{DatasetPage.cancel}" process="@this" update="@form" oncomplete="javascript:post_cancel_edit_files_or_metadata()">
                            <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="#{DatasetPage.editMode == 'METADATA' ? 1 : DatasetPage.selectedTabIndex}"/>
                        </p:commandButton>
                    </p:panel>

                    <!-- Tabs -->
                    <ui:fragment rendered="#{DatasetPage.editMode != 'INFO'}">
                        <div id="contentTabs">
                            <ui:fragment> <!-- rendered="#{empty DatasetPage.editMode}" -->
                                <p:commandButton id="refreshButton" widgetVar="refreshButton" actionListener="#{DatasetPage.refresh}" update="@all" style="display:none"/>
                                <script type="text/javascript">
                                    function updateFilesTable(facesmessage) {
                                        $('button[id$="refreshButton"]').trigger('click');
                                    }
                                </script>
                                <p:socket channel="/ingest#{dataset.id}" onMessage="updateFilesTable" autoConnect="true">
                                    <p:ajax event="message" update="@all" />
                                </p:socket>
                            </ui:fragment>
                            <p:tabView id="tabView" widgetVar="content" activeIndex="#{DatasetPage.selectedTabIndex}">
                                <p:tab id="dataFilesTab" title="#{bundle.files}" rendered="#{!DatasetPage.workingVersion.deaccessioned and
                                                                                   (empty DatasetPage.editMode or DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}" >
                                    <!-- Upload -->
                                    <!--<p:message for="fileUpload" showDetail="true"/>-->
                                    <ui:fragment rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}">
                                        <!--<ui:fragment rendered="#{DatasetPage.editMode == 'CREATE'}">
                                            <div class="alert alert-info">
                                                Tip: You can drag and drop your files from your desktop, directly into the upload widget.
                                            </div>
                                        </ui:fragment>-->
                                        <script>
                                            function uploadWidgetDropMsg() {
                                                var fileUpload = $('div[id$="fileUpload"] div.ui-fileupload-content');
                                                if ($(fileUpload).children('#dragdropMsg').length) {
                                                    // do nothing
                                                }
                                                else {
                                                    $(fileUpload).prepend('<div id="dragdropMsg">#{bundle['file.fromDropbox.description']}</div>');
                                                }
                                            }
                                            function uploadWidgetDropRemoveMsg() {
                                                $('div[id$="fileUpload"] div.ui-fileupload-content div.dropMsg').remove();
                                            }
                                            $(document).ready(function () {
                                                uploadWidgetDropMsg();
                                            });
                                        </script>
                                        <p:fileUpload id="fileUpload" dragDropSupport="true" auto="true" multiple="true" rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}"
                                                      fileUploadListener="#{DatasetPage.handleFileUpload}" process="filesTable" update="filesTable,uploadMessage" label="#{bundle['file.selectToAddBtn']}"
                                                      oncomplete="javascript:bind_bsui_components();uploadWidgetDropMsg();addDeleteTooltip();" onstart="javascript:uploadWidgetDropRemoveMsg();"/>

                                        <ui:fragment rendered="#{!empty DatasetPage.dropBoxKey}">
                                            <div id="dropboxUploadBlock" class="panel panel-default" style="margin-top:1em;">
                                                <div class="panel-body">
                                                    <h:inputText id="dropBoxSelectionInput" style="display:none" value="#{DatasetPage.dropBoxSelection}"/>
                                                    <p:commandButton id="dropBoxButton" actionListener="#{DatasetPage.handleDropBoxUpload}" update="@all" style="display:none">
                                                    </p:commandButton>
                                                    <p:commandButton value="#{bundle['file.fromDropbox']}" onclick="openDropboxChooser();" icon="dropin-btn-status"/>
                                                    <p class="help-block">#{bundle['file.fromDropbox.tip']}</p>
                                                </div>
                                            </div>
                                        </ui:fragment>
                                        <p:message for="fileUpload" id="uploadMessage" display="text"/>
                                    </ui:fragment>
                                    <!-- View -->
                                    <ui:fragment rendered="#{dataverseSession.user.authenticated and empty DatasetPage.editMode
                                                             and DatasetPage.workingVersion == DatasetPage.dataset.latestVersion
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand')}">
                                        <div class="" style="text-align:right; margin-top:1em; margin-bottom:.5em;">
                                            <p:commandLink style="color:black;" styleClass="btn btn-default" title="#{bundle['file.uploadOrEdit']}" actionListener="#{DatasetPage.edit('FILE')}" update="@form" oncomplete="javascript:post_edit_files();" disabled="#{DatasetPage.locked}">
                                                <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                <span class="glyphicon #{DatasetPage.locked ? 'glyphicon-ban-circle' : 'glyphicon-plus'}" style="margin-right:.3em;"/> #{bundle['file.uploadOrEdit']}
                                            </p:commandLink>
                                        </div>
                                    </ui:fragment>
                                    <!-- p:dataTable id="filesTable" value="#{empty DatasetPage.editMode ? DatasetPage.workingVersion.fileMetadatas : DatasetPage.dataset.latestVersion.fileMetadatas}" var="fileMetadata" -->
                                    <p:dataTable id="filesTable" style="margin-top:1em;" value="#{empty DatasetPage.editMode ? DatasetPage.workingVersion.fileMetadatas : DatasetPage.dataset.latestVersion.fileMetadatas}"
                                                 rowIndexVar="rowNum"
                                                 selection="#{DatasetPage.selectedFiles}" rowKey="#{fileMetadata.dataFile.fileSystemName}" var="fileMetadata" widgetVar="filesTable"
                                                 emptyMessage="#{bundle['file.notFound.tip']}">
                                        <p:column headerText="#{bundle['file.delete.header']}" selectionMode="multiple" rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}"
                                                  style="width:2%;text-align:center"/>
                                        <p:column styleClass="col-xs-1" style="text-align:center;">
                                            <ui:fragment rendered="#{!empty fileMetadata.dataFile.id and fileMetadata.dataFile.image}">
                                                <a class="imageThumbPreview" data-container="body" data-toggle="popover" data-placement="top" data-trigger="hover" data-html="true" data-content="&lt;img src=&#34;/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=400&#34; alt=&#34; #{bundle['file.preview']} #{fileMetadata.label}&#34; /&gt;">
                                                    <p:graphicImage value="/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=true"/>
                                                </a>
                                            </ui:fragment>

                                            <p:graphicImage value="/resources/images/icon_file.png" rendered="#{!fileMetadata.dataFile.image}"/>

                                            <ui:fragment rendered="#{empty fileMetadata.dataFile.id and !empty fileMetadata.dataFile.fileSystemName and fileMetadata.dataFile.image}">
                                                <p:graphicImage value="/api/access/imagethumb/#{fileMetadata.dataFile.fileSystemName}?mimetype=#{fileMetadata.dataFile.contentType}"/>
                                                <h:outputText id="imgPreview" value="Preview" styleClass="bg-info text-info" style="display:block;text-align:center;"/>
                                            </ui:fragment>
                                        </p:column>
                                        <p:column styleClass="col-sm-7">
                                            <h:outputText id="fileNameOutput" value="#{fileMetadata.label}" style="display:block;font-weight:bold;" rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}"/>

                                            <ui:fragment rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}">
                                                <label class="control-label" for="fileName" style="margin-right:1em;margin-bottom:.5em;">
                                                    #{bundle['file.fileName']}
                                                </label>
                                                <p:inputText id="fileName" value="#{fileMetadata.label}" style="margin-bottom:.5em;"/>
                                                <p:message for="fileName"/>
                                            </ui:fragment>

                                            <!-- TYPE + SIZE + DATE + MD5 -->
                                            <div class="text-muted">
                                                <h:outputText id="fileTypeOutputRegular" value="#{fileMetadata.dataFile.friendlyType} - " rendered="#{!(fileMetadata.dataFile.tabularData)}"/>
                                                <h:outputText id="fileTypeOutputTabular" value="#{bundle['file.type.tabularData']} - " rendered="#{fileMetadata.dataFile.tabularData}"/>
                                                <h:outputText id="fileSize" value="#{fileMetadata.dataFile.friendlySize} - " rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}"/>

                                                <h:outputText id="fileCreatePublishDate" value="#{DatasetPage.getFileDateToDisplay(fileMetadata)} - " rendered="#{!(empty fileMetadata.id)}"/>

<!--h:outputText id="fileMD5" value="MD5: #{fileMetadata.dataFile.md5}" rendered="#{!(empty fileMetadata.dataFile.md5) and !(fileMetadata.dataFile.tabularData) and ((DatasetPage.editMode != 'FILE' and DatasetPage.editMode != 'CREATE') or !DatasetPage.isDuplicate(fileMetadata))}"/-->
                                                <h:outputText id="fileMD5" value="#{fileMetadata.dataFile.tabularData ? bundle['file.MD5.origal'] : bundle['file.MD5']}: #{fileMetadata.dataFile.md5}; " rendered="#{!(empty fileMetadata.dataFile.md5) and ((DatasetPage.editMode != 'FILE' and DatasetPage.editMode != 'CREATE') or !DatasetPage.isDuplicate(fileMetadata))}"/>

                                                <h:outputText id="duplicateFileMD5" styleClass="text-danger" value="#{fileMetadata.dataFile.tabularData ? bundle['file.MD5.origal']: bundle['file.MD5']}: #{fileMetadata.dataFile.md5} " rendered="#{!(empty fileMetadata.dataFile.md5) and ((DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') and DatasetPage.isDuplicate(fileMetadata))}"/>
                                                <ui:fragment rendered="#{DatasetPage.isDuplicate(fileMetadata) and (DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') and (empty fileMetadata.id)}">
                                                    <div style="display:inline-block;" class="ui-message ui-message-error ui-widget ui-corner-all fileDuplicateWarning"><span class="ui-message-error-detail">#{bundle['file.MD5.exists.tip']}</span></div>
                                                </ui:fragment>
                                            </div>
                                            <!-- UNF + Variables, Obsersvations -->
                                            <ui:fragment rendered="#{fileMetadata.dataFile.tabularData}">
                                                <div>
                                                    <h:outputText id="fileNumVars" styleClass="text-muted" value="#{fileMetadata.dataFile.dataTable.varQuantity} #{bundle['file.metaData.dataFile.dataTab.variables']} " rendered="#{fileMetadata.dataFile.tabularData}"/>
                                                    <h:outputText id="fileNumObs" styleClass="text-muted" value="#{fileMetadata.dataFile.dataTable.caseQuantity} #{bundle['file.metaData.dataFile.dataTab.observations']} #{!empty fileMetadata.dataFile.unf ? ' - ' : ''}" rendered="#{fileMetadata.dataFile.tabularData}"/>
                                                    <h:outputText id="fileUNF" styleClass="text-muted" value="#{fileMetadata.dataFile.unf}" rendered="#{!empty fileMetadata.dataFile.unf}"/>
                                                </div>
                                            </ui:fragment>

                                            <ui:fragment rendered="#{DatasetPage.hasMapLayerMetadata(fileMetadata)}">
                                                <br /><br /> <a href="#{ DatasetPage.getMapLayerMetadata(fileMetadata.dataFile).getLayerLink() }">#{bundle['file.metaData.viewOnWorldMap']}</a>
                                                <br />
                                                <iframe id="id_iframe_map" height="300" width="100%" src="#{ DatasetPage.getMapLayerMetadata(fileMetadata.dataFile).getEmbedMapLink() }"></iframe>

                                                <!--br />Metadata here: #{ DatasetPage.getMapLayerMetadata(fileMetadata.dataFile).getId() }-->
                                            </ui:fragment>

                                            <ui:fragment rendered="#{(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') or !(empty fileMetadata.description)}">
                                                <div class="fileDescription">
                                                    <h:outputText id="fileDescNonEmpty" value="#{fileMetadata.description}" rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') and !(empty fileMetadata.description)}"/>
                                                    <!--<h:outputText id="fileDescEmpty" value="NO DESCRIPTION AVAILABLE" rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') and (empty fileMetadata.description)}"/>-->

                                                    <ui:fragment rendered="#{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE'}">
                                                        <label class="control-label" for="fileDescription" style="margin-right:1em; margin-top:.5em; vertical-align:top;">
                                                            #{bundle.description}
                                                        </label>
                                                        <p:inputTextarea  id="fileDescription" immediate="true" rows="2" cols="40" value="#{fileMetadata.description}" style="margin-top:.5em;"/>
                                                        <p:watermark for="fileDescription" value="#{bundle['file.addDescription']}"/>
                                                        <p:message for="fileDescription"/>
                                                    </ui:fragment>
                                                    
                                                </div>
                                            </ui:fragment>
                                            
                                            <div>
                                                <ui:fragment rendered="#{!(empty fileMetadata.categories)}">
                                                       <!-- TODO: do we need this label? L.A., beta 10 --><!-- h:outputText value="Categories: " styleClass="text-muted" / -->
                                                    <ui:repeat value="#{fileMetadata.categories}" var="cat">
                                                        <h:outputText value="#{cat.name}" styleClass="label label-info"/>
                                                        <h:outputText value=" "/>
                                                    </ui:repeat>
                                                    <h:outputText value=" "/>

                                                </ui:fragment>
                                                <!-- *old* file category code - removed from here. - L.A. beta 10 -->
                                                <ui:fragment rendered="#{(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}">

                                                    <p:commandButton id="fileCategoriesButton" 
                                                                     actionListener="#{DatasetPage.setFileMetadataSelected(fileMetadata)}" 
                                                                     update=":datasetForm:fileCategoriesPopup" 
                                                                     oncomplete="fileCategoriesPopup.show()" 
                                                                     value="#{bundle['file.editCategories']}"
                                                                     rendered="#{(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}"/>
                                                </ui:fragment>
                                            </div>

                                            <p/>

                                        </p:column>

                                        <p:column styleClass="col-sm-4" style="overflow: visible;text-align:right;" rendered="#{(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}">
                                            <ui:fragment rendered="#{fileMetadata.dataFile.tabularData or (!(empty fileMetadata.id) and fileMetadata.dataFile.image)}">
                                                <p:commandLink id="advancedIngestOptionsButton" 
                                                               styleClass="btn btn-default" 
                                                               actionListener="#{DatasetPage.setFileMetadataSelected(fileMetadata)}"
                                                               update=":datasetForm:fileAdvancedOptions"
                                                               oncomplete="fileAdvancedOptions.show()">
                                                    <span class="glyphicon glyphicon-cog" style="margin-right:.3em;"/> #{bundle['file.advancedOptions']}
                                                </p:commandLink>
                                            </ui:fragment>
                                        </p:column>

                                        <p:column styleClass="col-sm-4" style="overflow: visible;text-align:right;" rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}">
                                            <ui:fragment rendered="#{fileMetadata.dataFile.tabularData or fileMetadata.dataFile.ingestInProgress}">
                                                <h:outputLink style="margin-right:1em;color:black;font-size:1em;" class="btn btn-default #{fileMetadata.dataFile.ingestInProgress ? 'disabled' : ''}" disabled="#{fileMetadata.dataFile.ingestInProgress ? 'disabled' : ''}" title="Explore" value="#{DatasetPage.getDataExploreURLComplete(fileMetadata.dataFile.id)}" target="_blank">
                                                    <span class="glyphicon glyphicon-stats" style="margin-right:.3em;"/> <span class="ladda-label">#{bundle.explore}</span>
                                                </h:outputLink>
                                            </ui:fragment>

                                            <ui:fragment rendered="#{fileMetadata.dataFile.ingestProblem}">
                                                <a href="#" class="imageThumbPreview h2" style="margin:0 .5em 0 0;vertical-align:middle;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="left" data-html="true" data-title="&lt;span class='text-danger h5'&gt;#{bundle['file.ingestFailed']}&lt;/span&gt;" data-content="&lt;span class='text-danger'&gt;#{fileMetadata.dataFile.ingestReportMessage}&lt;/span&gt;">
                                                    <span class="glyphicon glyphicon-warning-sign text-danger" style="top:5px;"></span></a>
                                            </ui:fragment>

                                            <!--<ui:fragment rendered="#{fileMetadata.dataFile.ingestInProgress}">
                                                <p:graphicImage value="/resources/images/icon_inprogress.gif"/>
                                            </ui:fragment>-->

                                            <ui:fragment rendered="#{ dataverseSession.user.authenticated and (DatasetPage.isShapefileType(fileMetadata)) }"> <!-- and (!(DatasetPage.hasMapLayerMetadata(fileMetadata))) }"-->
                                                <a style="margin-right:1em;color:black;font-size:1em;" class="btn btn-default" href="#{fileMetadata.dataFile.getMapItURL(dataverseSession.user.id)}" target="_blank" role="button">
                                                    <span class="glyphicon glyphicon-map-marker" style="margin-right:.3em;"/>
                                                    <h:outputText rendered="#{DatasetPage.hasMapLayerMetadata(fileMetadata)}" value="#{bundle['file.reMapData']}" />
                                                    <h:outputText rendered="#{!(DatasetPage.hasMapLayerMetadata(fileMetadata))}" value="#{bundle['file.mapData']}" />
                                                </a>
                                            </ui:fragment>
                                            <!-- non-tabular data file: -->
                                            <!-- no guest book/terms of use/etc. - straight to the download API url: -->
                                            <ui:fragment rendered="#{!(fileMetadata.dataFile.tabularData) and !(DatasetPage.downloadPopupRequired)}">
                                                <a class="btn btn-default" href="/api/access/datafile/#{fileMetadata.dataFile.id}" role="button" style="color:#333333;">
                                                    <span class="glyphicon glyphicon-download-alt" style="margin-right:.3em;"/> 
                                                </a>
                                            </ui:fragment>
                                            <!-- guest book or terms of use, etc. enabled - open "download popup" first: -->
                                            <ui:fragment rendered="#{!(fileMetadata.dataFile.tabularData) and DatasetPage.downloadPopupRequired}">
                                                <p:commandLink id="downloadPopupButton" 
                                                               styleClass="btn btn-default" 
                                                               action="#{DatasetPage.initGuestbookResponse(fileMetadata)}"
                                                               update="@form,:messagePanel"
                                                               oncomplete="downloadPopup.show();">
                                                    <span class="glyphicon glyphicon-download-alt" style="margin-right:.3em;"/> #{bundle.download}
                                                </p:commandLink>
                                            </ui:fragment>
                                            

                                            <ui:fragment rendered="#{fileMetadata.dataFile.tabularData}">
                                                <div class="btn-group">
                                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                                        <span class="glyphicon glyphicon-download-alt" style="margin-right:.3em;"/> #{bundle.download} <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu multi-level pull-right" role="menu" style="text-align:left;">
                                                        <li>
                                                            <h:outputLink value="/api/access/datafile/bundle/#{fileMetadata.dataFile.id}"  disabled="#{empty fileMetadata.dataFile.id}">
                                                                <!--strong>All File Formats + Information</strong-->
                                                                <strong><h:outputText value="#{bundle['file.downloadBtn.format.all']}"/></strong>
                                                            </h:outputLink>
                                                        </li>
                                                        <li role="presentation" class="divider"></li>
                                                        <li>
                                                            <ui:fragment rendered="#{!(DatasetPage.downloadPopupRequired)}">
                                                            <h:outputLink value="/api/access/datafile/#{fileMetadata.dataFile.id}" disabled="#{empty fileMetadata.dataFile.id}">
                                                                <h:outputText value="#{bundle['file.downloadBtn.format.tab']}"/>
                                                            </h:outputLink>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{DatasetPage.downloadPopupRequired}">
                                                                <p:commandLink id="downloadPopupButtonTab" 
                                                                    action="#{DatasetPage.initGuestbookResponse(fileMetadata)}"
                                                                    update="@form,:messagePanel"
                                                                    oncomplete="downloadPopup.show();">
                                                                        #{bundle['file.downloadBtn.format.tab']}
                                                                </p:commandLink>    
                                                            </ui:fragment>
                                                            
                                                        </li>
                                                        <li>
                                                            <h:outputLink value="/api/access/datafile/#{fileMetadata.dataFile.id}?format=original"  disabled="#{empty fileMetadata.dataFile.id}">
                                                                <h:outputFormat value="#{bundle['file.downloadBtn.format.original']}">
                                                                    <f:param value="#{fileMetadata.dataFile.originalFormatLabel}"/>
                                                                </h:outputFormat>
                                                            </h:outputLink>
                                                        </li>
                                                        <li>
                                                            <h:outputLink value="/api/access/datafile/#{fileMetadata.dataFile.id}?format=RData" rendered="#{!fileMetadata.dataFile.originalFormatLabel == 'RData'}" disabled="#{empty fileMetadata.dataFile.id}">
                                                                <h:outputText value="#{bundle['file.downloadBtn.format.rdata']}"/>
                                                            </h:outputLink>
                                                        </li>
                                                        <li>
                                                            <h:outputLink value="/api/meta/datafile/#{fileMetadata.dataFile.id}"  disabled="#{empty fileMetadata.dataFile.id}">
                                                                <h:outputText value="#{bundle['file.downloadBtn.format.var']}"/>
                                                            </h:outputLink>
                                                        </li>
                                                        <li class="dropdown-submenu">
                                                            <a tabindex="-1" href="javascript:void(0);">#{bundle['file.downloadBtn.format.citation']}</a>
                                                            <ul class="dropdown-menu">
                                                                <li>
                                                                    <h:commandLink id="risLinkFile" actionListener="#{DatasetPage.downloadDatafileCitationRIS(fileMetadata)}">
                                                                        <h:outputText value="#{bundle['dataset.cite.downloadBtn.ris']}" />
                                                                    </h:commandLink>
                                                                </li>
                                                                <li>
                                                                    <h:commandLink id="endNoteLinkFile" action="#{DatasetPage.downloadDatafileCitationXML(fileMetadata)}" >
                                                                        <h:outputText value="#{bundle['dataset.cite.downloadBtn.xml']}" />
                                                                    </h:commandLink>
                                                                </li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </ui:fragment>

                                            <ui:fragment rendered="#{fileMetadata.dataFile.ingestInProgress}">
                                                <h:outputText id="txtInprogess" value="#{bundle['file.ingestInproGress']}" styleClass="bg-info text-info" style="display:block;text-align:center;"/>
                                            </ui:fragment>
                                        </p:column>
                                    </p:dataTable>
                                    
                                </p:tab>

                                <p:tab  id="metadataMapTab" title="#{bundle['file.dataFilesTab.metadata.header']}"
                                        rendered="#{!DatasetPage.workingVersion.deaccessioned and (empty DatasetPage.editMode or DatasetPage.editMode == 'METADATA')}"
                                        >
                                    <ui:fragment rendered="#{dataverseSession.user.authenticated and empty DatasetPage.editMode
                                                             and DatasetPage.workingVersion == DatasetPage.dataset.latestVersion
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand')}">
                                        <div class="" style="text-align:right; margin-bottom:.5em;">
                                            <p:graphicImage value="/resources/images/icon_locked.png" rendered="#{DatasetPage.locked}"/>
                                            <p:commandLink style="color:black;" styleClass="btn btn-default" title="#{bundle['file.dataFilesTab.metadata.addBtn']}" actionListener="#{DatasetPage.edit('METADATA')}" update="@form" oncomplete="javascript:post_edit_metadata()" disabled="#{DatasetPage.locked}">
                                                <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                <span class="glyphicon glyphicon-pencil" style="margin-right:.3em;"/> #{bundle['file.dataFilesTab.metadata.addBtn']}
                                            </p:commandLink>
                                        </div>
                                    </ui:fragment>
                                    <div style="clear:left;">
                                        <ui:include src="metadataFragment.xhtml"/>
                                    </div>
                                </p:tab>
                                <p:tab id="licensingTermsTab" title="#{bundle['file.dataFilesTab.terms.header']}" rendered="#{empty DatasetPage.editMode or DatasetPage.editMode == 'LICENSE'}">
                                    <ui:fragment rendered="#{dataverseSession.user.authenticated and empty DatasetPage.editMode
                                                             and DatasetPage.workingVersion == DatasetPage.dataset.latestVersion
                                                             and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand')}">
                                        <div class="" style="text-align:right; margin-bottom:.5em;">
                                            <p:graphicImage value="/resources/images/icon_locked.png" rendered="#{DatasetPage.locked}"/>
                                            <p:commandLink style="color:black;" styleClass="btn btn-default" title="#{bundle['file.dataFilesTab.metadata.addBtn']}" actionListener="#{DatasetPage.edit('LICENSE')}" update="@form" oncomplete="javascript:post_edit_metadata()" disabled="#{DatasetPage.locked}">
                                                <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="0" />
                                                <span class="glyphicon glyphicon-briefcase" style="margin-right:.3em;"/> #{bundle['file.dataFilesTab.terms.editLicensingBtn']}
                                            </p:commandLink>
                                        </div>
                                    </ui:fragment>
                                    <p class="help-block">#{bundle['file.dataFilesTab.terms.description']}</p>
                                    <div class="panel-group">
                                        <div class="panel panel-default" style="margin-bottom:1em;">
                                            <div data-toggle="collapse" data-target="#collapseLiscensingTOU" class="panel-heading text-info">
                                                 #{bundle['file.dataFilesTab.terms.list.termsOfUse.header']}<span class="glyphicon glyphicon-chevron-up" style="margin-left:.3em;top:3px;"/>
                                            </div>
                                            <div id="collapseLiscensingTOU" class="collapse in">
                                                <div class="panel-body">
                                                    <div class="form-group">
                                                        <label for="metadata_Licensing" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing']}
                                                            </a>
                                                        </label>
                                                        <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                            <ui:fragment rendered="#{DatasetPage.workingVersion.license == 'CC0'}">
                                                                <div class="col-sm-9">
                                                                    <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.txt']}</p>
                                                                </div>
                                                                <div class="col-sm-9">
                                                                    <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.txt.description']}</p>
                                                                </div>
                                                            </ui:fragment>
                                                        </ui:fragment>
                                                        <ui:fragment rendered ="#{!empty DatasetPage.editMode }">
                                                            <p:selectOneRadio id="options" value="#{DatasetPage.workingVersion.license}">
                                                                <f:selectItem itemLabel="#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.select.CCO']}" itemValue="CC0" />
                                                                <f:selectItem itemLabel="#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.select.notCCO']}" itemValue="" />
                                                                <p:ajax update=":datasetForm" />                                                
                                                            </p:selectOneRadio>      
                                                            <ui:fragment rendered="#{DatasetPage.workingVersion.license == 'CC0'}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.select.tip']} 
                                                                <div class="col-sm-9">
                                                                    <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.select.description']}</p>
                                                                </div>
                                                                <div class="col-sm-9">
                                                                    <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfUse.licensing.txt']}</p>
                                                                </div>
                                                            </ui:fragment>  
                                                        </ui:fragment>
                                                    </div>
                                                    <ui:fragment rendered="#{DatasetPage.workingVersion.license != 'CC0'}">
                                                        <div class="form-group">
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.termsOfUse.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.termsOfUse']}
                                                                </a>
                                                            </label>
                                                            <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                                <div class="col-sm-9">
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.termsOfUse}"/>
                                                                </div>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.editMode}">
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.termsOfUse}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            </ui:fragment>
                                                        </div>
                                                    </ui:fragment>
                                                </div>
                                                <div class="panel panel-default">
                                                    <div class="panel-heading" role="tab" id="headingTOU">
                                                        <h4 class="panel-title">
                                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#additionalTOU" aria-expanded="false" aria-controls="additionalTOU">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo']}
                                                            </a>
                                                        </h4>
                                                    </div>
                                                    <div id="additionalTOU" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTOU">
                                                        <div class="panel-body">
                                                            <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                                <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.confidentialityDeclaration}">      
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">                                                                
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.declaration']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.confidentialityDeclaration}"/>
                                                                </div>
                                                                    </ui:fragment> 
                                                                <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.specialPermissions}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.permissions']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.specialPermissions}"/>
                                                                </div>
                                                                    </ui:fragment>
                                                             <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.restrictions}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.restrictions']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.restrictions}"/>
                                                                </div>
                                                                    </ui:fragment>
                                                             <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.citationRequirements}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.citationRequirements']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersioncitationRequirements}"/>
                                                                </div>
                                                                    </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.depositorRequirements}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.depositorRequirements']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.depositorRequirements}"/>
                                                                </div>
                                                                    </ui:fragment>  
                                                             <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.conditions}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.conditions']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.conditions}"/>
                                                                </div>
                                                                    </ui:fragment>
                                                             <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.disclaimer}"> 
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.disclaimer']}
                                                            </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.disclaimer}"/>
                                                                </div>
                                                                    </ui:fragment>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.editMode}">
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.declaration.title']}">
                                                                     #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.declaration']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.confidentialityDeclaration}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.permissions.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.permissions']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.specialPermissions}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.restrictions.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.restrictions']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.restrictions}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.citationRequirements.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.citationRequirements']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.citationRequirements}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.depositorRequirements.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.depositorRequirements']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.depositorRequirements}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.conditions.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.conditions']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.conditions}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.disclaimer.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo.disclaimer']}
                                                                </a>
                                                            </label>
                                                                <div class="col-sm-9">
                                                                    <p:inputTextarea value="#{DatasetPage.workingVersion.disclaimer}" rows="5" cols="60"  styleClass="form-control" />
                                                                </div>
                                                            </ui:fragment>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="panel panel-default" style="margin-bottom:1em;">
                                            <div data-toggle="collapse" data-target="#collapseRestrictedFilesTOA" class="panel-heading text-info">
                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.header']} <span class="glyphicon glyphicon-chevron-up" style="margin-left:.3em;top:3px;"/>
                                            </div>
                                            <div id="collapseRestrictedFilesTOA" class="collapse in">
                                                <div class="panel-body">
                                                     <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                    <div class="form-group">
                                                        <label for="metadata_RestrictedFiles" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles']}
                                                            </a>
                                                        </label>
                                                        <div class="col-sm-9">
                                                            <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles.txt']}</p>
                                                        </div>
                                                    </div>
                                                   
                                                    <div class="form-group">
                                                        <label for="metadata_TermsAccess" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.termsOfsAccess.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.termsOfsAccess']}
                                                            </a>
                                                        </label>
                                                        <div class="col-sm-9">
                                                            <h:outputText value ="#{DatasetPage.workingVersion.termsOfAccess}"/>
                                                        </div>
                                                    </div>
                                                       <div class="form-group">
                                                        <label for="metadata_RequestAccess" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess']}
                                                            </a>
                                                        </label>
                                                           
                                                        <div class="col-sm-9">
                                                            <h:outputText value ="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess.request']}" rendered="#{DatasetPage.dataset.fileAccessRequest}"/>
                                                            <h:outputText value ="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess.notRequest']}" rendered="#{!DatasetPage.dataset.fileAccessRequest}"/>
                                                        </div>
                                                               
                                                    </div>
                                                    </ui:fragment>
                                                    <ui:fragment rendered ="#{!empty DatasetPage.editMode}">
                                                    <div class="form-group">
                                                        <label for="metadata_RestrictedFiles" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles']}
                                                            </a>
                                                        </label>
                                                        <div class="col-sm-9">
                                                            <p class="help-block">#{bundle['file.dataFilesTab.terms.list.termsOfAccess.restrictedFiles.tip']}</p>
                                                        </div>
                                                    </div>
                                                   
                                                    <div class="form-group">
                                                        <label for="metadata_TermsAccess" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.termsOfsAccess.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.termsOfsAccess']}
                                                            </a>
                                                        </label>
                                                        <div >
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.termsOfAccess}" rows="5" cols="60"  styleClass="form-control" />
                                                        </div>
                                                    </div>
                                                       <div class="form-group">
                                                        <label for="metadata_RequestAccess" class="col-sm-3 control-label">
                                                            <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess.title']}">
                                                                #{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess']}
                                                            </a>
                                                        </label>
                                                           
                                                        <div class="col-sm-9">
                                                             <p:selectBooleanCheckbox  id="requestAccess" itemLabel="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.requestAccess.enableBtn']}" value="#{DatasetPage.dataset.fileAccessRequest}"/>
                                                        </div>
                                                               
                                                    </div>                                                        
                                                    </ui:fragment>
                                                </div>
                                            </div>
                                            <div class="panel panel-default">
                                                <div class="panel-heading" role="tab" id="headingTOA">
                                                    <h4 class="panel-title">
                                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTOA" aria-expanded="false" aria-controls="collapseTOA">
                                                            #{bundle['file.dataFilesTab.terms.list.termsOfUse.addInfo']}
                                                        </a>
                                                    </h4>
                                                </div>
                                                <div id="collapseTOA" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTOA">
                                                    <div class="panel-body">
                                                        <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.dataAccessPlace}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.dataAccessPlace']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.dataAccessPlace}"/>
                                                                </div>
                                                            </ui:fragment> 
                                                             <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.originalArchive}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.originalArchive']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.originalArchive}"/>
                                                                </div>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.availabilityStatus}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.availabilityStatus']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.availabilityStatus}"/>
                                                                </div>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.contactForAccess}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.contactForAccess']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.contactForAccess}"/>
                                                                </div>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.sizeOfCollection}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.sizeOfCollection']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersion.sizeOfCollection}"/>
                                                                </div>
                                                            </ui:fragment>
                                                            <ui:fragment rendered ="#{!empty DatasetPage.workingVersion.studyCompletion}"> 
                                                                <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.studyCompletion']}
                                                                </label>
                                                                <div class="col-sm-9"  >
                                                                    <h:outputText value ="#{DatasetPage.workingVersiont.studyCompletion}"/>
                                                                </div>
                                                            </ui:fragment>
                                                        </ui:fragment>
                                                        <ui:fragment rendered ="#{!empty DatasetPage.editMode}">

                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.dataAccessPlace.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.dataAccessPlace']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.dataAccessPlace}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.originalArchive.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.originalArchive']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.originalArchive}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.availabilityStatus.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.availabilityStatus']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.availabilityStatus}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.contactForAccess.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.contactForAccess']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.contactForAccess}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.sizeOfCollection.tip']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.sizeOfCollection']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.sizeOfCollection}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                            <label for="metadata_TermsUse" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.studyCompletion.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.addInfo.studyCompletion']}
                                                                </a>
                                                            </label>
                                                            <div class="col-sm-9">
                                                                <p:inputTextarea value="#{DatasetPage.workingVersion.studyCompletion}" rows="5" cols="60"  styleClass="form-control" />
                                                            </div>
                                                        </ui:fragment>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="panel panel-default" style="margin-bottom:1em;">
                                            <div data-toggle="collapse" data-target="#collapseGuestbook" class="panel-heading text-info">
                                                 #{bundle['file.dataFilesTab.terms.list.guestbook']}<span class="glyphicon glyphicon-chevron-up" style="margin-left:.3em;top:3px;"/>
                                            </div>
                                            <div id="collapseGuestbook" class="collapse in">
                                                <div class="panel-body">
                                                    <div class="form-group">
                                                       <ui:fragment rendered ="#{empty DatasetPage.editMode}">
                                                           <ui:fragment rendered="#{!empty DatasetPage.dataset.guestbook}">

                                                            <label for="metadata_Guestbook" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.guestbook.inUse.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.guestbook.inUse']}
                                                                </a>
                                                            </label>
                                                        </ui:fragment>

                                                                <h:outputText value="#{DatasetPage.dataset.guestbook.name} " rendered="#{!empty DatasetPage.dataset.guestbook}"/>

                                                                <p:commandLink styleClass="btn btn-default" rendered="#{!empty DatasetPage.dataset.guestbook}"
                                                                               value="#{bundle['file.dataFilesTab.terms.list.guestbook.viewBtn']}" 
                                                                               action="#{DatasetPage.viewSelectedGuestbook(DatasetPage.dataset.guestbook)}"
                                                                               oncomplete="viewGuestbook.show()"
                                                                               update=":datasetForm"
                                                                               style="color:black;margin-right:0.5em;"/>

                                                        <ui:fragment rendered="#{empty DatasetPage.dataset.guestbook}">
                                                            <label for="metadata_Guestbook" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.guestbook.noSelected.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.guestbook.noSelected']}
                                                                </a>
                                                            </label>
                                                        </ui:fragment>
                                                        </ui:fragment>
                                                        <ui:fragment rendered ="#{!empty DatasetPage.editMode}">
                                                        <ui:fragment rendered="#{!empty DatasetPage.dataset.dataverseContext.availableGuestbooks}">

                                                            <label for="metadata_Guestbook" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.guestbook.availableGuestbooks.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.guestbook.availableGuestbooks']}
                                                                </a>
                                                            </label>
                                                        </ui:fragment>
                                                        <p:commandButton value="#{bundle['file.dataFilesTab.terms.list.guestbook.clearBtn']}" update="guestbookTable" process="@this" actionListener="#{DatasetPage.reset}"/>
                                                        <p:dataTable id="guestbookTable" value="#{DatasetPage.dataset.dataverseContext.availableGuestbooks}" var="guestbook" widgetVar="guestbookTable"
                                                                     rendered="#{!empty DatasetPage.dataset.dataverseContext.availableGuestbooks}"
                                                                     rowIndexVar="rowNum" selection="#{DatasetPage.dataset.guestbook}"  rowKey="#{guestbook}">
                                                            <p:column selectionMode="single" rendered="true"
                                                                      style="width:2%;text-align:center"/>

                                                            <p:column> 
                                                                <h:outputText value="#{guestbook.name} " />
                                                            </p:column>
                                                            <p:column> 
                                                                <p:commandLink styleClass="btn btn-default" 
                                                                               value="#{bundle['file.dataFilesTab.terms.list.guestbook.viewBtn']}" 
                                                                               action="#{DatasetPage.viewSelectedGuestbook(guestbook)}"
                                                                               oncomplete="viewGuestbook.show()"
                                                                               update=":datasetForm"
                                                                               style="color:black;margin-right:0.5em;"/>
                                                            </p:column>
                                                        </p:dataTable>
                                                        <ui:fragment rendered="#{empty DatasetPage.dataset.dataverseContext.availableGuestbooks}">
                                                            <label for="metadata_Guestbook" class="col-sm-3 control-label">
                                                                <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.dataFilesTab.terms.list.guestbook.noAvailable.title']}">
                                                                    #{bundle['file.dataFilesTab.terms.list.guestbook.noAvailable']}
                                                                </a>
                                                            </label>
                                                        </ui:fragment>
                                                        </ui:fragment>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p:dialog id="viewGuestbook" header="#{bundle['dataset.manageGuestbooks.tab.action.btn.view.dialog.header']}" widgetVar="viewGuestbook" width="600px" height="600px" style="overflow-y: scroll;">
                                        <div class="form-horizontal">

                                            <div class="form-group">
                                                <label for="select_DatasetTemplate" class="col-sm-3 control-label">
                                                    <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['dataset.manageGuestbooks.tab.action.btn.view.dialog.datasetGuestbook.title']}">#{bundle['dataset.manageGuestbooks.tab.action.btn.view.dialog.datasetGuestbook']}</a>
                                                </label>
                                                <div class="col-sm-7" style="padding-top: 7px;">
                                                    #{DatasetPage.selectedGuestbook.name}
                                                </div>
                                            </div>
                                        </div>
                                        <div  style="padding-top: 7px;">
                                            <h:outputText value="#{DatasetPage.selectedGuestbook.requiredAccountInformationString}" 
                                                          rendered="#{!empty DatasetPage.selectedGuestbook.requiredAccountInformationString }"/>
                                        </div>
                                        <div style="padding-top: 7px;">
                                            <h:outputText value="#{DatasetPage.selectedGuestbook.optionalAccountInformationString}" 
                                                          rendered="#{!empty DatasetPage.selectedGuestbook.optionalAccountInformationString }"/>
                                        </div>
                                        <div style="padding-top: 7px;">
                                            <h:outputText value="#{DatasetPage.selectedGuestbook.requiredCustomQuestionsString}" 
                                                          rendered="#{!empty DatasetPage.selectedGuestbook.requiredCustomQuestionsString }"/>
                                        </div>
                                        <div style="padding-top: 7px;">
                                            <h:outputText value="#{DatasetPage.selectedGuestbook.optionalCustomQuestionsString}" 
                                                          rendered="#{!empty DatasetPage.selectedGuestbook.optionalCustomQuestionsString }"/>
                                        </div>
                                    </p:dialog>
                                </p:tab>
                                <p:tab id="versionsTab" title="#{bundle['file.dataFilesTab.versions']}" rendered="#{empty DatasetPage.editMode}">
                                    <p:commandButton value="#{bundle['file.dataFilesTab.versions.showDiffBtn']}" style="margin-bottom:.5em;"
                                                     onclick="testCheckBoxes();"
                                                     rendered="#{DatasetPage.compareVersionsCount > 2}">
                                    </p:commandButton>
                                    <p:commandButton value="Direct" id="compareVersions"
                                                     style="display:none"
                                                     update=":datasetForm"
                                                     oncomplete="detailsBlocks.show();post_differences();"
                                                     actionListener="#{DatasetPage.compareVersionDifferences()}">
                                    </p:commandButton>

                                    <p:dataTable id="versionsTable" value="#{DatasetPage.versionTabList}" var="versionTab" widgetVar="versionsTable"
                                                 rowIndexVar="rowNum" selection="#{DatasetPage.selectedVersions}" disabledSelection="#{versionTab.deaccessioned}"  rowKey="#{versionTab}">
                                        <p:column selectionMode="multiple" rendered="#{DatasetPage.compareVersionsCount > 2}"
                                                  style="width:2%;text-align:center"/>
                                        <p:column>
                                            <ui:fragment rendered="#{versionTab.released or ((versionTab.deaccessioned or versionTab.draft) and permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand'))}">
                                                <h:link id="versionLink" styleClass="ui-commandlink ui-widget" outcome="dataset">
                                                    <h:outputText rendered="#{!(versionTab.released or versionTab.deaccessioned)}" value="#{versionTab.versionState}" />
                                                    <h:outputText rendered="#{versionTab.released or versionTab.deaccessioned}" value="#{versionTab.versionNumber}.#{versionTab.minorVersionNumber}" />
                                                    <f:param name="id" value="#{versionTab.dataset.id}" />
                                                    <f:param name="versionId" value="#{versionTab.id}" />
                                                </h:link>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{versionTab.deaccessioned and  !(permissionServiceBean.on(DatasetPage.dataset).canIssueCommand('UpdateDatasetCommand'))}">
                                                <h:outputText rendered="#{!(versionTab.released or versionTab.deaccessioned)}" value="#{versionTab.versionState}" />
                                                <h:outputText rendered="#{versionTab.released or versionTab.deaccessioned}" value="#{versionTab.versionNumber}.#{versionTab.minorVersionNumber}" />
                                            </ui:fragment>
                                        </p:column>
                                        <p:column>
                                            <ui:fragment rendered="#{versionTab.defaultVersionDifference != null}">
                                                <ui:fragment rendered="#{!empty(versionTab.defaultVersionDifference.summaryDataForNote)}">
                                                    <h:outputLabel value="#{bundle['file.dataFilesTab.versions.citationMetadata']} " />
                                                    <ui:repeat value="#{versionTab.defaultVersionDifference.summaryDataForNote}" var="summaryNote">
                                                        <h:outputText value=" #{summaryNote[0].datasetFieldType.displayName} (" />
                                                        <h:outputText rendered="#{(summaryNote[1]) > 0 and summaryNote[0].datasetFieldType.allowMultiples}"  value="#{summaryNote[1]} #{bundle['file.dataFilesTab.versions.added']}" />
                                                        <h:outputText rendered="#{(summaryNote[1]) > 0 and !(summaryNote[0].datasetFieldType.allowMultiples)}"  value="#{bundle['file.dataFilesTab.versions.added']}" />
                                                        <h:outputText rendered="#{(summaryNote[1]) > 0 and (summaryNote[2] + summaryNote[3]) > 0}"  value=", " />
                                                        <h:outputText rendered="#{(summaryNote[2]) > 0 and summaryNote[0].datasetFieldType.allowMultiples}"  value="#{summaryNote[2]} #{bundle['file.dataFilesTab.versions.removed']}" />
                                                        <h:outputText rendered="#{(summaryNote[2]) > 0 and !(summaryNote[0].datasetFieldType.allowMultiples)}"  value="#{bundle['file.dataFilesTab.versions.removed']}" />
                                                        <h:outputText rendered="#{(summaryNote[2]) > 0 and (summaryNote[3]) > 0}"  value=", " />
                                                        <h:outputText rendered="#{(summaryNote[3]) > 0 and summaryNote[0].datasetFieldType.allowMultiples}"  value="#{summaryNote[3]} #{bundle['file.dataFilesTab.versions.changed']}" />
                                                        <h:outputText rendered="#{(summaryNote[3]) > 0 and !(summaryNote[0].datasetFieldType.allowMultiples)}"  value="#{bundle['file.dataFilesTab.versions.changed']}" />
                                                        <h:outputText value="); " />
                                                    </ui:repeat>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{!empty(versionTab.defaultVersionDifference.blockDataForNote)}">
                                                    <ui:repeat value="#{versionTab.defaultVersionDifference.blockDataForNote}" var="blockNote">
                                                        <h:outputLabel rendered="#{blockNote[0].datasetFieldType.metadataBlock.displayName == 'Citation Metadata'}" value="#{bundle['file.dataFilesTab.versions.additionalCitationMetadata']} " />
                                                        <h:outputLabel rendered="#{!(blockNote[0].datasetFieldType.metadataBlock.displayName == 'Citation Metadata')}" value=" #{blockNote[0].datasetFieldType.metadataBlock.displayName}: " />
                                                        <h:outputText value=" (" />
                                                        <h:outputText rendered="#{blockNote[1] > 0}" value="#{blockNote[1]} #{bundle['file.dataFilesTab.versions.added']}" />
                                                        <h:outputText rendered="#{(blockNote[1]) > 0 and (blockNote[2] + blockNote[3]) > 0}" value=", " />
                                                        <h:outputText rendered="#{(blockNote[2]) > 0}" value="#{blockNote[2]} #{bundle['file.dataFilesTab.versions.removed']}" />
                                                        <h:outputText rendered="#{(blockNote[2]) > 0 and (blockNote[3]) > 0}" value=", " />
                                                        <h:outputText rendered="#{(blockNote[3]) > 0}" value="#{blockNote[3]} #{bundle['file.dataFilesTab.versions.changed']}" />
                                                        <h:outputText value="); " />
                                                    </ui:repeat>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{!empty(versionTab.defaultVersionDifference.fileNote)}">
                                                    <h:outputLabel value="#{versionTab.defaultVersionDifference.fileNote}" />
                                                </ui:fragment>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{versionTab.defaultVersionDifference == null}">
                                                <ui:fragment rendered="#{versionTab.draft}">
                                                    #{bundle['file.dataFilesTab.versions.description.draft']}
                                                </ui:fragment>
                                                <ui:fragment rendered="#{versionTab.released and versionTab.priorVersionState == 'DEACCESSIONED'}">
                                                    #{bundle['file.dataFilesTab.versions.description.deaccessioned']}
                                                </ui:fragment>
                                                <ui:fragment rendered="#{versionTab.released and versionTab.priorVersionState == null}">
                                                    #{bundle['file.dataFilesTab.versions.description.firstPublished']}
                                                </ui:fragment>
                                                <ui:fragment rendered="#{versionTab.deaccessioned}">
                                                    #{bundle['file.dataFilesTab.versions.description.deaccessionedReason']} #{versionTab.versionNote} <ui:fragment rendered="#{!empty versionTab.archiveNote}">#{bundle['file.dataFilesTab.versions.description.beAccessedAt']} <a href="#{versionTab.archiveNote}" target="_blank">#{versionTab.archiveNote}</a></ui:fragment>
                                                </ui:fragment>
                                            </ui:fragment>
                                            <p:commandLink rendered="#{(!empty(versionTab.defaultVersionDifference)) and DatasetPage.versionTabList.size() > (rowNum + 1)}"
                                                           actionListener="#{DatasetPage.updateVersionDifferences(versionTab, null)}"
                                                           oncomplete="detailsBlocks.show();post_differences();"
                                                           update=":datasetForm"
                                                           value="#{bundle['file.dataFilesTab.versions.showDetails.btn']}" style="margin-left:1em;"></p:commandLink>
                                        </p:column>
                                        <p:column style="min-width:140px;">
                                            <!-- FIXME Commented this out, as there is no such property at this time. Michael -->
                                            <h:outputText value="#{versionTab.contributorNames}" />
                                        </p:column>
                                        <p:column>
                                            <h:outputText  id="versionDate" value="#{versionTab.versionDate}" style="white-space:nowrap;" />
                                        </p:column>
                                    </p:dataTable>
                                </p:tab>
                            </p:tabView>
                        </div>
                    </ui:fragment>
                    <p:confirmDialog id="compareTwo" message="#{bundle['file.dataFilesTab.versions.showDiff.dialog.header']}" header="#{bundle['file.dataFilesTab.versions.showDiff.dialog.txt']}" widgetVar="compareTwo">
                    </p:confirmDialog>
                    <p:confirmDialog message="#{bundle['file.deleteDialog.tip']}" header="#{bundle['file.deleteDialog.header']}" widgetVar="deleteConfirmation">
                        <p:commandButton value="#{bundle.continue}" onclick="deleteConfirmation.hide()" action="#{DatasetPage.deleteDataset()}">
                        </p:commandButton>
                        <p:commandButton value="#{bundle.cancel}" onclick="deleteConfirmation.hide()" type="button" />
                    </p:confirmDialog>
                    <p:confirmDialog message="#{bundle['file.deleteDraftDialog.tip']}" header="#{bundle['file.deleteDraftDialog.header']}" widgetVar="deleteVersionConfirmation">
                        <p:commandButton value="#{bundle.continue}" onclick="deleteVersionConfirmation.hide()" action="#{DatasetPage.deleteDatasetVersion()}">
                        </p:commandButton>
                        <p:commandButton value="#{bundle.cancel}" onclick="deleteVersionConfirmation.hide()" type="button" />
                    </p:confirmDialog>
                    <p:confirmDialog message="#{bundle['file.deleteFileDialog.tip']}" header="#{bundle['file.deleteFileDialog.header']}" widgetVar="deleteFileConfirmation">
                        <ui:fragment rendered="#{DatasetPage.dataset.released}">
                            #{bundle['file.deleteFileDialog.failed.tip']}
                        </ui:fragment>
                        <p:commandButton value="#{bundle.continue}" onclick="deleteFileConfirmation.hide()" action="#{DatasetPage.save()}">
                        </p:commandButton>
                        <p:commandButton value="#{bundle.cancel}" onclick="deleteFileConfirmation.hide()" type="button" />
                    </p:confirmDialog>
                    <p:dialog id="deaccessionBlock" header="#{bundle['dataset.editBtn.itemLabel.deaccession']}" widgetVar="deaccessionBlock" modal="true">
                        <p class="text-danger"><span class="glyphicon glyphicon-warning-sign"></span> #{bundle['file.deaccessionDialog.tip']}</p>
                        <ui:fragment rendered="#{DatasetPage.releasedVersionTabList.size() > 1}">
                            <div class="form-group">
                                <label for="deaccessionOptions">Which version(s) do you want to deaccession? <span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span></label>
                                <p:dataTable id="versionDeaccessionTable" value="#{DatasetPage.releasedVersionTabList}" var="versionTab" widgetVar="versionDeaccessionTable"
                                             rowIndexVar="rowNum" selection="#{DatasetPage.selectedDeaccessionVersions}" rowKey="#{versionTab}">
                                    <p:column selectionMode="multiple" style="width:2%;text-align:center;"/>
                                    <p:column>
                                        <h:outputText value="#{bundle['file.deaccessionDialog.version']} #{versionTab.versionNumber}.#{versionTab.minorVersionNumber}, #{versionTab.versionDate}" />
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </ui:fragment>
                        <div class="form-group">
                            <label for="deaccessionOptions"> #{bundle['file.deaccessionDialog.reason.questions']}<span class="glyphicon glyphicon-asterisk text-danger" title="#{bundle.requiredField}"></span></label>
                            <h:selectOneMenu id="reasonOptions" styleClass="form-control" value="#{DatasetPage.deaccessionReasonRadio}">
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.header']}" itemValue="0" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.identifiable']}" itemValue="1" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.beRetracted']}" itemValue="2" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.beTransferred']}" itemValue="3" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.IRB']}" itemValue="4" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.legalIssue']}" itemValue="5" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.notValid']}" itemValue="6" />
                                <f:selectItem itemLabel="#{bundle['file.deaccessionDialog.reason.selectItem.other']}" itemValue="7" />
                            </h:selectOneMenu>
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="fileDescription">
                                #{bundle['file.deaccessionDialog.enterInfo']}
                            </label>
                            <p:inputTextarea id="reasonForDeaccession" styleClass="form-control" immediate="true" rows="2" cols="40"
                                             onkeyup="updateHiddenReason(this);"   value="#{DatasetPage.deaccessionReasonText}" widgetVar="reasonForDeaccession"/>
                            <p:message for="reasonForDeaccession"/>
                        </div>
                        <div class="form-group">
                            <label class="control-label" ><!--for="forwardURLForDeaccession"-->
                                #{bundle['file.deaccessionDialog.leaveURL']}
                            </label>
                            <p:inputText id="forwardURLForDeaccession" styleClass="form-control" value="#{DatasetPage.deaccessionForwardURLFor}" widgetVar="forwardURLForDeaccession"/>
                            <!--<p:message for="forwardURLForDeaccession"/>-->
                        </div>
                        <ui:fragment rendered="#{DatasetPage.releasedVersionTabList.size() > 1}">
                            <button type="button" class="btn btn-success" value="Deaccession" onclick="testDeaccessionVersionSelection(true);">#{bundle.deaccession}</button>
                        </ui:fragment>
                        <ui:fragment rendered="#{DatasetPage.releasedVersionTabList.size() == 1}">
                            <button type="button" class="btn btn-success" value="Deaccession" onclick="testDeaccessionVersionSelection(false);">#{bundle.deaccession}</button>
                        </ui:fragment>
                        <button type="button" class="btn btn-default" value="Cancel" onclick="deaccessionBlock.hide()">#{bundle.cancel}</button>
                    </p:dialog>
                    <p:dialog id="deaccessionConfirmation" header="Deaccession Dataset" widgetVar="deaccessionConfirmation" modal="true">
                        <p>#{bundle['file.deaccessionDialog.deaccession.tip']}</p>
                        <h:commandButton styleClass="btn btn-success" value="#{bundle.yes}" onclick="deaccessionConfirmation.hide();
                                deaccessionBlock.hide()" action="#{DatasetPage.deaccessionVersions}" />
                        <button type="button" class="btn btn-default" value="No" onclick="deaccessionConfirmation.hide()">#{bundle.no}</button>
                    </p:dialog>
                    <p:dialog id="deaccessionAllConfirmation" header="#{bundle['dataset.editBtn.itemLabel.deaccession']}" widgetVar="deaccessionAllConfirmation" modal="true">
                        <p>#{bundle['file.deaccessionDialog.deaccessionDataset.tip']}</p>
                        <h:commandButton styleClass="btn btn-success" value="Yes" onclick="deaccessionAllConfirmation.hide();
                                deaccessionBlock.hide()" action="#{DatasetPage.deaccessionVersions}" />
                        <button type="button" class="btn btn-default" value="No" onclick="deaccessionAllConfirmation.hide()">#{bundle.no}</button>
                    </p:dialog>
                    <p:confirmDialog id="selectDeaccessionVersion" message="#{bundle['file.deaccessionDialog.dialog.selectVersion.tip']}" header="#{bundle['file.deaccessionDialog.dialog.selectVersion.header']}" widgetVar="selectDeaccessionVersion"> </p:confirmDialog>
                    <p:confirmDialog id="selectDeaccessionReason" message="#{bundle['file.deaccessionDialog.dialog.reason.tip']}" header="#{bundle['file.deaccessionDialog.dialog.reason.header']}" widgetVar="selectDeaccessionReason"> </p:confirmDialog>
                    <p:confirmDialog id="enterForwardUrl" message="#{bundle['file.deaccessionDialog.dialog.url.tip']}" header="#{bundle['file.deaccessionDialog.dialog.url.header']}" widgetVar="enterForwardUrl"> </p:confirmDialog>
                    <p:confirmDialog id="enterOtherReason" message="#{bundle['file.deaccessionDialog.dialog.textForReason.tip']}" header="#{bundle['file.deaccessionDialog.dialog.textForReason.header']}" widgetVar="enterOtherReason"> </p:confirmDialog>
                    <p:confirmDialog id="reasonTooManyCharacters" message="#{bundle['file.deaccessionDialog.dialog.limitChar.tip']}" header="#{bundle['file.deaccessionDialog.dialog.limitChar.header']}" widgetVar="reasonTooManyCharacters"> </p:confirmDialog>
                    <p:inputText id="hiddenReasonInput" style="display:none" widgetVar="hiddenReasonInput"/>
                    <ui:fragment id="detailsBlock">
                        <p:dialog id="detailsBlocks" header="#{bundle['file.showDiffDialog.header']}" widgetVar="detailsBlocks">
                            <h:outputLabel value="#{bundle['file.showDiffDialog.viewing']} #{DatasetPage.datasetVersionDifference.newVersion.title}" />
                            <div class="clearfix" style="margin-bottom:1em;">
                                <div class="pull-right text-left" style="width:35%;padding:4px 10px;border: 1px solid #DDDDDD;border-left-width:0;">
                                    #{bundle['file.showDiffDialog.version']} #{DatasetPage.datasetVersionDifference.newVersion.semanticVersion}<br/>
                                    #{bundle['file.showDiffDialog.lastUpdated']} #{DatasetPage.datasetVersionDifference.newVersion.lastUpdateTime}
                                </div>
                                <div class="pull-right text-left" style="width:35%;padding:4px 10px;border: 1px solid #DDDDDD;">
                                    #{bundle['file.showDiffDialog.version']} #{DatasetPage.datasetVersionDifference.originalVersion.semanticVersion}<br/>
                                    #{bundle['file.showDiffDialog.lastUpdated']} #{DatasetPage.datasetVersionDifference.originalVersion.lastUpdateTime}
                                </div>
                                <div class="pull-right text-left" style="width:30%;padding:4px 10px;">
                                    &#160;
                                </div>
                            </div>
                            <ui:fragment rendered="#{!empty(DatasetPage.datasetVersionDifference.detailDataByBlock)}">
                                <ui:repeat value="#{DatasetPage.datasetVersionDifference.detailDataByBlock}" var="block">
                                    <div class="panel panel-default">
                                        <div class="panel-heading text-info">
                                            <h:outputText value="#{block.get(0)[0].datasetFieldType.metadataBlock.displayName}" />
                                        </div>
                                        <p:dataTable id="byBlockInner" styleClass="dvnDifferanceTable" var="dsfArray" value="#{block}">
                                            <p:column styleClass="versionValue">
                                                <h:outputText value="#{dsfArray[0].datasetFieldType.title}" />
                                            </p:column>
                                            <p:column styleClass="versionDetails">
                                                <h:outputText rendered="#{dsfArray[0].datasetFieldType.primitive and !(dsfArray[0].isEmpty())}" value="#{dsfArray[0].displayValue}" />
                                                <h:outputText rendered="#{!dsfArray[0].datasetFieldType.primitive and !(dsfArray[0].isEmpty())}" value="#{dsfArray[0].compoundDisplayValue}" />
                                            </p:column>
                                            <p:column styleClass="versionDetails" >
                                                <h:outputText rendered="#{dsfArray[1].datasetFieldType.primitive and !(dsfArray[1].isEmpty())}" value="#{dsfArray[1].displayValue}" />
                                                <h:outputText rendered="#{!dsfArray[1].datasetFieldType.primitive and !(dsfArray[1].isEmpty())}" value="#{dsfArray[1].compoundDisplayValue}" />
                                            </p:column>
                                        </p:dataTable>
                                    </div>
                                </ui:repeat>
                            </ui:fragment>
                            <ui:fragment rendered="#{!empty(DatasetPage.datasetVersionDifference.fileNote)}">
                                <div class="panel panel-default">
                                    <div class="panel-heading text-info" rendered="#{!empty(DatasetPage.datasetVersionDifference.datasetFilesDiffList)}">
                                        <h:outputText id="outputText" value="#{bundle.files}"/>
                                    </div>
                                    <p:dataTable id="diffFilesDataTable" styleClass="dvnDifferanceTable" value="#{DatasetPage.datasetVersionDifference.datasetFilesDiffList}" var="fileDiff">
                                        <p:column styleClass="versionValue">
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileID']} #{fileDiff.fileId}"/>
                                        </p:column>
                                        <p:column styleClass="versionDetails" rendered="#{! fileDiff.file1Empty}">
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileName']} #{fileDiff.fileName1}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileName1 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileType']} #{fileDiff.fileType1}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileType1 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileSize']} #{fileDiff.fileSize1}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileSize1 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.category']} #{fileDiff.fileCat1}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileCat1 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.description']} #{fileDiff.fileDesc1}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileDesc1 != null}"/>
                                        </p:column>
                                        <p:column styleClass="versionDetails" rendered="#{fileDiff.file1Empty}">
                                            &#160;
                                        </p:column>
                                        <p:column styleClass="versionDetails" rendered="#{! fileDiff.file2Empty}">
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileName']} #{fileDiff.fileName2}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileName2 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileType']} #{fileDiff.fileType2}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileType2 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.fileSize']} #{fileDiff.fileSize2}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileSize2 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.category']} #{fileDiff.fileCat2}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileCat2 != null}"/>
                                            <h:outputText value="#{bundle['file.showDiffDialog.description']} #{fileDiff.fileDesc2}" styleClass="diffDetailBlock" rendered="#{fileDiff.fileDesc2 != null}"/>
                                        </p:column>
                                        <p:column styleClass="versionDetails" rendered="#{fileDiff.file2Empty}">
                                            &#160;
                                        </p:column>
                                    </p:dataTable>
                                </div>
                            </ui:fragment>
                        </p:dialog>
                    </ui:fragment>
                    <ui:fragment rendered="#{DatasetPage.editMode == 'CREATE'}">
                        <div class="alert alert-info" style="margin-top:.5em;">
                            #{bundle['file.metadataTip']}
                        </div>
                    </ui:fragment>

                    <!-- Create/Save Dataset Button Panel -->
                    <p:panel styleClass="panelLayoutButtonBlock" rendered="#{!empty DatasetPage.editMode}">
                        <p:commandButton id="save"  value="#{DatasetPage.editMode == 'CREATE' ? bundle['file.addBtn'] : bundle.saveChanges}" onclick="checkFilesSelected();" >
                        </p:commandButton>
                        <p:commandButton id="cancel" value="#{bundle.cancel}" action="#{DatasetPage.cancel}" process="@this" update="@form"  rendered="#{DatasetPage.editMode != 'CREATE'}" oncomplete="javascript:post_cancel_edit_files_or_metadata()">
                            <f:setPropertyActionListener target="#{DatasetPage.selectedTabIndex}" value="#{DatasetPage.editMode == 'METADATA' ? 1 : DatasetPage.selectedTabIndex}"/>
                        </p:commandButton>
                        <p:button id="cancelCreate" value="#{bundle.cancel}" outcome="/dataverse.xhtml?id=#{DatasetPage.ownerId}"  rendered="#{DatasetPage.editMode == 'CREATE'}" />
                    </p:panel>
                    <p:commandButton value="Direct" id="datasetSave"
                                     style="display:none"
                                     update=":datasetForm"
                                     oncomplete="javascript:bind_bsui_components();"
                                     action="#{DatasetPage.save}">
                    </p:commandButton>

                    <ui:include src="rolesAndPermissionsFragment.xhtml"/>

                    <p:dialog id="fileAdvancedOptions" header="#{bundle['file.advancedOptions']}" widgetVar="fileAdvancedOptions" modal="true">
                        <p class="help-block"></p>
                        <style type="text/css">
                            .form-group table.noBorders {width:100%;}
                            .form-group table.noBorders td {width:50%;}
                            .form-group table.noBorders td .form-control {width:100%;}
                        </style>
                        <div class="form-inline clearfix" style="min-width:800px;">
                            <!-- "Data File Tags" - these only apply to tabular files, for now: -->
                            <ui:fragment rendered="#{DatasetPage.fileMetadataSelected.dataFile.tabularData}">
                                <div class="form-group col-sm-12">
                                    <label for="tabularDataTags" class="col-sm-4 control-label">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.tabularDataTags.title']}">
                                            #{bundle['file.tabularDataTags']} 
                                        </a>
                                    </label>
                                    <div class="col-sm-8">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <p:selectCheckboxMenu id="tabularDataTags" value="#{DatasetPage.selectedTags}" label="#{bundle['file.addTags']}"
                                                                  filter="false" panelStyle="width:300px">
                                                <f:selectItems value="#{DatasetPage.tabFileTags}" />
                                            </p:selectCheckboxMenu>
                                            <p:message for="tabularDataTags" display="text" />
                                        </p:panelGrid>
                                    </div>
                                </div>
                            </ui:fragment>

                            <!-- Assign this to be the "dataset thumbnail" (only applies to image files, for now) -->
                            <ui:fragment rendered="false">
                                <div class="form-group col-sm-12">
                                    <label for="spssSavEncodingLanguage" class="col-sm-4 control-label">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.spss-savEncoding.title']}">
                                            #{bundle['file.spss-savEncoding']}
                                        </a>
                                    </label>
                                    <div class="col-sm-8">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <h:outputText value="**REMOVE ME** Dropdown"/>
                                            <h:outputText value="Error Msg **REMOVE ME**"/>
                                        </p:panelGrid>
                                        <!-- REPLACE THESE WITH YOUR DYNAMIC FORM COMPONENTS AND ERROR MSG AND PUT THEM INTO THE PANELGRID ABOVE 
                                            <p:inputText id="spssSavEncodingLanguage" styleClass="form-control"/>
                                            <p:message for="spssSavEncodingLanguage" display="text" /> -->
                                    </div>
                                </div>
                            </ui:fragment>
                            <ui:fragment rendered="#{!(empty DatasetPage.fileMetadataSelected.id) and DatasetPage.fileMetadataSelected.dataFile.image}">
                                <div class="form-group col-sm-12">
                                    <label for="datasetThumbnailImage" class="col-sm-4 control-label">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle.description}">
                                            #{bundle['file.datasetThumbnailImage']}
                                        </a>
                                    </label>
                                    <div class="col-sm-8">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <p:column>
                                                <p:selectBooleanCheckbox  id="datasetThumbnailImage" itemLabel="#{bundle['file.useThisIamge']}" value="#{DatasetPage.useAsDatasetThumbnail}"/>

                                                <p:message for="datasetThumbnailImage" display="text" />
                                            </p:column>
                                        </p:panelGrid>
                                    </div>
                                </div>
                            </ui:fragment>
                            <ui:fragment rendered="false">
                                <div class="form-group col-sm-12">
                                    <label for="fileTags" class="col-sm-4 control-label">
                                        <a href="#" data-toggle="tooltip" data-placement="auto right" class="tooltiplabel right" data-original-title="#{bundle['file.fileTags.title']}">
                                            #{bundle['file.fileTags']}
                                        </a>
                                    </label>
                                    <div class="col-sm-8">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <h:outputText value="**REMOVE ME** Multiple Select Dropdown w/Checkboxes"/>
                                            <h:outputText value="Error Msg **REMOVE ME**"/>
                                        </p:panelGrid>
                                        <!-- REPLACE THESE WITH YOUR DYNAMIC FORM COMPONENTS AND ERROR MSG AND PUT THEM INTO THE PANELGRID ABOVE 
                                            <p:inputText id="fileTags" styleClass="form-control"/>
                                            <p:message for="fileTags" display="text" /> -->
                                    </div>
                                </div>
                            </ui:fragment>
                        </div>
                        <p:commandButton id="fileAdvancedOptionsSaveButton" value="#{bundle.saveChanges}" oncomplete="fileAdvancedOptions.hide()" actionListener="#{DatasetPage.saveAdvancedOptions()}"/>
                        <p:commandButton id="fileAdvancedOptionsCancelButton" value="#{bundle.cancel}" onclick="fileAdvancedOptions.hide()"/>
                    </p:dialog>

                    <p:dialog  header="#{bundle['file.downloadDialog.header']}" widgetVar="downloadPopup">
                        #{bundle['file.downloadDialog.tip']}
                        <ui:fragment rendered="#{DatasetPage.workingVersion.license != 'CC0' and !empty DatasetPage.workingVersion.termsOfUse}">
                            <div  style="padding-top: 7px;">
                                <h:outputText value="#{DatasetPage.workingVersion.termsOfUse}" />
                            </div>
                            <div  style="padding-top: 7px;">
                                <p:selectBooleanCheckbox  id="acceptTOU" itemLabel="#{bundle['file.downloadDialog.termsTip']}" value="#{DatasetPage.acceptedTerms}"/>
                            </div>
                        </ui:fragment>
                        <ui:fragment rendered="#{!empty DatasetPage.workingVersion.termsOfAccess}">
                            <div  style="padding-top: 7px;">
                                <h:outputText value="#{DatasetPage.workingVersion.termsOfAccess}" />
                            </div>
                        </ui:fragment>
                        <ui:fragment rendered="#{DatasetPage.dataset.guestbook != null}">
                            <div  style="padding-top: 7px;">
                                #{bundle['file.downloadDialog.name']} <h:inputText value="#{DatasetPage.guestbookResponse.name}"/>
                            </div>
                            <div  style="padding-top: 7px;">
                                #{bundle.name} <h:inputText value="#{DatasetPage.guestbookResponse.email}"/>
                            </div>
                            <div  style="padding-top: 7px;">
                                #{bundle.institution} <h:inputText value="#{DatasetPage.guestbookResponse.institution}"/>
                            </div>
                            <div  style="padding-top: 7px;">
                                #{bundle.position} <h:inputText value="#{DatasetPage.guestbookResponse.position}"/>
                            </div>
                        </ui:fragment>
                        <ui:fragment rendered="#{(DatasetPage.dataset.guestbook != null) and (!empty DatasetPage.dataset.guestbook.customQuestions)}">
                            <ui:repeat value="#{DatasetPage.guestbookResponse.customQuestionResponses}" var="customQuestionResponse">
                                <ui:fragment rendered="#{customQuestionResponse.customQuestion.questionType=='text'}">
                                    <h:outputText value ="#{customQuestionResponse.customQuestion.questionString}"/>
                                    <h:inputText value="#{customQuestionResponse.response}"/>
                                </ui:fragment>
                                <ui:fragment rendered="#{customQuestionResponse.customQuestion.questionType=='options'}">
                                    <h:outputText value ="#{customQuestionResponse.customQuestion.questionString}"/>
                                    <p:selectOneMenu value="#{customQuestionResponse.response}" >
                                        <f:selectItem itemLabel="Select" itemValue="" />
                                        <f:selectItems value="#{customQuestionResponse.responseSelectItems}"></f:selectItems>
                                    </p:selectOneMenu>
                                </ui:fragment>
                            </ui:repeat>
                        </ui:fragment>    
                        <p:commandButton value="#{bundle.saveChanges}" onclick="downloadPopup.hide()" update=":messagePanel" action="#{DatasetPage.saveGuestbookResponse()}" >
                        </p:commandButton>
                        <p:commandButton value="#{bundle.cancel}" onclick="downloadPopup.hide()" type="button" />
                    </p:dialog>  
                    
                    <p:dialog id="fileCategoriesPopup" header="#{bundle['file.editCategoriesDialog.header']}" widgetVar="fileCategoriesPopup" modal="true">
                        <p class="help-block"></p>
                        <style type="text/css">
                                    .form-group table.noBorders {width:100%;}
                                    .form-group table.noBorders td {width:50%;}
                                    .form-group table.noBorders td .form-control {width:100%;}
                        </style>
                        <div class="form-inline clearfix" style="min-width:800px;">
                            <ui:fragment rendered="#{!(empty DatasetPage.fileMetadataSelected)}">
                                <div class="form-group col-sm-12">
                                    <label for="fileCategoriesMenu" class="col-sm-3 control-label">
                                         #{bundle['file.editCategoriesDialog.select']}
                                    </label>
                                    <div class="col-sm-9">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <p:selectManyMenu id="fileCategoriesMenu" value="#{DatasetPage.fileMetadataSelected.categoriesByName}" showCheckbox="true">
                                                <f:selectItems value="#{DatasetPage.fileMetadataSelected.datasetVersion.dataset.categoriesByName}"/>          
                                            </p:selectManyMenu>
                                            <p:message for="fileCategoriesMenu" display="text" />
                                        </p:panelGrid>
                                    </div>
                                </div>
                                <div class="form-group col-sm-12">
                                    <label for="fileCategoryAddNew" class="col-sm-3 control-label">
                                         #{bundle['file.editCategoriesDialog.add']}
                                    </label>
                                    <div class="col-sm-9">
                                        <p:panelGrid columns="2" styleClass="noBorders">
                                            <p:inputText id="fileCategoryAddNew" type="text" value="#{DatasetPage.newCategoryName}" placeholder="#{bundle['file.editCategoriesDialog.newName']}"/>
                                            <p:message for="fileCategoryAddNew" display="text" />
                                        </p:panelGrid>
                                    </div>
                                </div>
                            </ui:fragment>
                        </div>
                        <p:commandButton id="fileCategoriesPopupSaveButton" value="#{bundle.saveChanges}" oncomplete="fileCategoriesPopup.hide()" update=":datasetForm:tabView:filesTable" actionListener="#{DatasetPage.addFileCategory()}"/>
                        <p:commandButton id="fileCategoriesPopupCancelButton" value="#{bundle.cancel}" onclick="fileCategoriesPopup.hide()"/>
                    </p:dialog>
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
