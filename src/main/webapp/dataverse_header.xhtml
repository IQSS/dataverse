<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:iqbs="http://xmlns.jcp.org/jsf/composite/iqbs">

    <o:resourceInclude path="/CustomizationFilesServlet?customFileType=header" rendered="#{!widgetWrapper.widgetView}"/>
    
    <div id="dataverse-header-block">
        <!-- Navbar Panel -->
        <nav id="navbarFixed" class="navbar navbar-default navbar-fixed-top" jsf:rendered="#{!widgetWrapper.widgetView}">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavBar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    
                    
                    <ui:fragment rendered="#{empty settingsWrapper.get(':LogoCustomizationFile')}">
                        <a href="/">
                            <span class="navbar-brand"><i id="icon-dataverse" class="icon-dataverse"></i> #{bundle.dataverse}</span>
                        </a>
                    </ui:fragment>

                    <ui:fragment rendered="#{!empty settingsWrapper.get(':LogoCustomizationFile')}">                       
                        <a href="/">
                            <h:graphicImage url="#{settingsWrapper.get(':LogoCustomizationFile')}"/>
                        </a>
                    </ui:fragment>
                    
                    
                    <h:outputLink value="#" onclick="PF('statusInfo').show()" rendered="#{!empty settingsWrapper.get(':StatusMessageText')}">
                        <span class="label label-default status">#{!empty settingsWrapper.get(':StatusMessageHeader') ? settingsWrapper.get(':StatusMessageHeader') : bundle['header.status.header']}</span>
                    </h:outputLink>
                    <ui:fragment rendered="#{empty settingsWrapper.get(':StatusMessageText') and !empty settingsWrapper.get(':StatusMessageHeader')}">
                        <span class="label label-default status">#{settingsWrapper.get(':StatusMessageHeader')}</span>
                    </ui:fragment>
                </div>
                <!-- QDRCustom- Menu Items -->
                <div class="collapse navbar-collapse" id="topNavBar">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a id="navbar-search-toggle" title="#{bundle['header.search.title']}">
                                <span class="glyphicon glyphicon-search"></span>
                            </a>
                        </li>
                        <form class="navbar-form navbar-left" role="search" style="display:none;">
                            <div class="form-group">
                                <label class="sr-only" for="navbarsearch">#{bundle.search}</label>
                                <input id="navbarsearch" type="text" class="search-input ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all" size="28" value="" placeholder="#{bundle['header.search.title']}"/>            
                            </div>                            
                            <button type="submit" class="btn btn-default" onclick="window.location = '/dataverse/#{dataverseServiceBean.findRootDataverse().alias}?q=' + document.getElementById('navbarsearch').value;
                                    return false;">
                                <span class="glyphicon glyphicon-search"/> #{bundle.find}
                            </button>
                        </form>
                        <li class="dropdown">
                            <div style="padding-top:15px; padding-bottom:15px; margin-left:20px;">
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/about">
                                        #{bundle['header.about']}
                                </h:outputLink> 
                                <span class="dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false" style="display:inline; padding-left:2px;">
                                    <b class="caret"></b>
                                </span>
                                <ul class="dropdown-menu" style="margin-top:-1px;">
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/about/governance">
                                            Governance
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/contact">
                                            Contact
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="dropdown">
                            <div style="padding-top:15px; padding-bottom:15px; margin-left:10px;">
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/deposit">
                                    Deposit
                                </h:outputLink> 
                                <span class="dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false" style="display:inline; padding-left:2px;">
                                    <b class="caret"></b>
                                </span>                            
                                <ul class="dropdown-menu" style="margin-top:-1px;">
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/deposit/projects">
                                            Project Types
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/deposit/data">
                                            Data Types
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/deposit/activecitations">
                                            Active Citation Compilations
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/deposit/process">
                                            Deposit Process
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="dropdown">
                            <div style="padding-top:15px; padding-bottom:15px; margin-left:10px;">
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/discover">
                                    Discover
                                </h:outputLink> 
                                <span class="dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false" style="display:inline; padding-left:2px;">
                                    <b class="caret"></b>
                                </span>
                                <ul class="dropdown-menu" style="margin-top:-1px;">
                                    <li>
                                        <h:outputLink value="/">
                                            Search and Browse Data
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/discover/pilots">
                                            Pilot Projects
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="dropdown">
                            <div style="padding-top:15px; padding-bottom:15px; margin-left:10px;">
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/guidance">
                                    Guidance and Resources
                                </h:outputLink> 
                                <span class="dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false" style="display:inline; padding-left:2px;">
                                    <b class="caret"></b>
                                </span>
                                <ul class="dropdown-menu" style="margin-top:-1px;">
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/guidance/managing">
                                            Managing Data
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/guidance/citing">
                                            Citing and Referencing Data
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/guidance/teaching">
                                            Teaching with Data
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/guidance/workshops">
                                            Workshops and Training
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="dropdown">
                            <div style="padding-top:15px; padding-bottom:15px; margin-left:10px;">
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/qdr-publications">
                                    Publications
                                </h:outputLink> 
                                <span class="dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false" style="display:inline; padding-left:2px;">
                                    <b class="caret"></b>
                                </span>
                                <ul class="dropdown-menu" style="margin-top:-1px;">
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/qdr-blog">
                                            Blog
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/qdr-publications/qdr-access">
                                            QDR Access
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li jsf:rendered="#{dataverseSession.user.superuser}">
                            <h:outputLink value="/dashboard.xhtml?dataverseId=#{dataverseServiceBean.findRootDataverse().id}">
                                <h:outputText value="#{bundle['header.dashboard']}" />
                            </h:outputLink>
                        </li>
                        <ui:fragment rendered="#{!dataverseSession.user.authenticated}">
                            <li>
                                <h:outputLink value="/Shibboleth.sso/Login">
                                    <f:param name="target" value="#{request.contextPath.concat('/shib.xhtml').concat(navigationWrapper.redirectPage)}" />
                                    #{bundle.login}
                                </h:outputLink>
                            </li>
                            <li>
                                <h:outputLink value="#{settingsWrapper.get(':QDRDrupalSiteURL')}/user/register">                                    
                                    Register
                                </h:outputLink>
                            </li>
                        </ui:fragment>
                        <ui:fragment rendered="#{dataverseSession.user.authenticated}">
                            <li class="dropdown accountName">
                                <span id="lnk_header_account_dropdown" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">
                                    <ui:fragment rendered="#{dataverseSession.user.superuser}">
                                        <span class="glyphicon glyphicon-user text-danger"></span>
                                    </ui:fragment>
                                    <h:outputText styleClass="#{dataverseSession.user.superuser ? 'text-danger' : ''}" value="#{dataverseSession.user.displayInfo.title}" id="userDisplayInfoTitle"/>
                                    <h:outputText styleClass="label label-danger" rendered="#{ dataverseHeaderFragment.getUnreadNotificationCount(dataverseSession.user.id) > 0 }"
                                                  value="#{ dataverseHeaderFragment.getUnreadNotificationCount(dataverseSession.user.id) }" />                                    <b class="caret"></b>
                                </span>
                                <ul class="dropdown-menu">
                                    <li>
                                        <h:outputLink value="/dataverseuser.xhtml">
                                            <f:param name="selectTab" value="dataRelatedToMe" />
                                            <h:outputText value="#{bundle['header.user.selectTab.dataRelated']}" />
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="/dataverseuser.xhtml">
                                            <f:param name="selectTab" value="notifications" />
                                            <h:outputText value="#{bundle['header.user.selectTab.notifications']}" />
                                            <h:outputText styleClass="label label-danger" rendered="#{ dataverseHeaderFragment.getUnreadNotificationCount(dataverseSession.user.id) > 0 }"
                                                          value="#{dataverseHeaderFragment.getUnreadNotificationCount(dataverseSession.user.id)}" />
                                        </h:outputLink>
                                    </li>
                                    <ui:remove>
                                        <li>
                                            <h:outputLink value="/dataverseuser.xhtml">
                                                <f:param name="selectTab" value="groupsRoles" />
                                                <h:outputText value="#{bundle['header.user.selectTab.groupsAndRoles']}" />
                                            </h:outputLink>
                                        </li>
                                    </ui:remove>
                                    <li>
                                        <h:outputLink value="/dataverseuser.xhtml">
                                            <f:param name="selectTab" value="accountInfo" />
                                            <h:outputText value="#{bundle['header.accountInfo']}" />
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink value="/dataverseuser.xhtml">
                                            <f:param name="selectTab" value="apiTokenTab" />
                                            <h:outputText value="#{bundle['header.user.selectTab.apiToken']}" />
                                        </h:outputLink>
                                    </li>
                                    <li class="divider"></li>
                                    <li class="logout">
                                        <o:form useRequestURI="true" styleClass="navbar-form navbar-left" pt:role="logout">
                                            <h:commandLink action="#{dataverseHeaderFragment.logout}" id="lnk_header_logout">
                                                <h:outputText value="#{bundle['header.logOut']}" />
                                            </h:commandLink>
                                        </o:form>
                                    </li>
                                </ul>
                            </li>
                        </ui:fragment>
                    </ul>
                </div>
            </div>
        </nav>
        <ui:param name="dataversePage" value="#{dataverseLinksStayOnPage == true ? '' : '/dataverse.xhtml' }"/>

        <!-- Header Panel -->
        <div id="dataverseHeader" class="container bg-muted"
                style="background:##{!empty dataverse.dataverseTheme.backgroundColor ? dataverse.dataverseTheme.backgroundColor : 'F5F5F5'};"
                jsf:rendered="#{showDataverseHeader and !widgetWrapper.widgetView}">
             <o:importFunctions type="org.apache.commons.lang.StringEscapeUtils"/>
            <div class="dataverseHeaderLogo" style="text-align:#{!empty dataverse.dataverseTheme.logoAlignment ? dataverse.dataverseTheme.logoAlignment : 'center'};; background:##{!empty dataverse.dataverseTheme.logoBackgroundColor ? dataverse.dataverseTheme.logoBackgroundColor : 'F5F5F5'};"
                 jsf:rendered="#{!empty dataverse.dataverseTheme.logo and dataverse.dataverseTheme.logoFormat == 'RECTANGLE'}">
                <img src="/logos/#{dataverse.logoOwnerId}/#{dataverse.dataverseTheme.logo}" alt="#{dataverse.name}"/>
            </div>
            <div class="dataverseHeaderBlock">
                <div class="dataverseHeaderCell dataverseHeaderLogo" jsf:rendered="#{!empty dataverse.dataverseTheme.logo and dataverse.dataverseTheme.logoFormat == 'SQUARE'}">
                    <img src="/logos/#{dataverse.logoOwnerId}/#{dataverse.dataverseTheme.logo}" alt="#{dataverse.name}"/>
                </div>
                <div class="dataverseHeaderCell dataverseHeaderName" jsf:rendered="#{!empty dataverse.name}">
                    <a href="/dataverse/#{dataverse.alias}" class="dataverseHeaderDataverseName" style="color:##{!empty dataverse.dataverseTheme.linkColor ? dataverse.dataverseTheme.linkColor : '428bca'};">#{dataverse.name}</a>
                    <h:outputText style="color:##{!empty dataverse.dataverseTheme.textColor ? dataverse.dataverseTheme.textColor : '888888'};" value=" (#{dataverse.affiliation})" rendered="#{!empty dataverse.affiliation}"/>
                    <h:outputText value="#{bundle.unpublished}" styleClass="label label-warning label-unpublished" rendered="#{!dataverse.released}"/>
                </div>
                <div class="dataverseHeaderCell dataverseHeaderName" jsf:rendered="#{empty dataverse.name}">
                    <h:outputText styleClass="dataverseHeaderDataverseName" value="#{bundle.newDataverse}"/>
                </div>
                <div class="dataverseHeaderCell dataverseHeaderTagline" jsf:rendered="#{!empty dataverse.dataverseTheme.tagline and empty dataverse.dataverseTheme.linkUrl}">
                    <h:outputText escape="false" style="color:##{!empty dataverse.dataverseTheme.textColor ? dataverse.dataverseTheme.textColor : '888888'};" value="#{StringEscapeUtils:escapeHtml(dataverse.dataverseTheme.tagline)}" />
                </div>
                <div class="dataverseHeaderCell dataverseHeaderLink" jsf:rendered="#{!empty dataverse.dataverseTheme.tagline and !empty dataverse.dataverseTheme.linkUrl}">
                    <h:outputLink value="#{dataverse.dataverseTheme.linkUrl}" style="color:##{!empty dataverse.dataverseTheme.linkColor ? dataverse.dataverseTheme.linkColor : '428bca'};" target="_blank">
                        <h:outputText value="#{StringEscapeUtils:escapeHtml(dataverse.dataverseTheme.tagline)}" escape="false"/>
                    </h:outputLink>
                </div>
            </div>
        </div>

        <div id="breadcrumbNavBlock" class="container" jsf:rendered="#{dataverseHeaderFragment.breadcrumbs.size() > 1}">
            <ui:repeat value="#{dataverseHeaderFragment.breadcrumbs}" var="breadcrumb" varStatus="status">
                <h:outputText value=" > " styleClass="breadcrumbCarrot" rendered="#{!status.first}"/>
                <div class="breadcrumbBlock">
                    <h:outputText value="#{breadcrumb.breadcrumbText}" styleClass="#{'breadcrumbActive'}" rendered="#{status.last}"/>
                    <ui:fragment rendered="#{!status.last}">
                        <h:outputText value="#{breadcrumb.breadcrumbText}" rendered="#{!breadcrumb.dvObject.instanceofDataverse and !breadcrumb.dvObject.instanceofDataset and !breadcrumb.dvObject.instanceofDataFile and empty breadcrumb.url}"/>
                        <ui:fragment rendered="#{breadcrumb.dvObject == null and !empty breadcrumb.url}">
                            <ui:remove><!-- No widget code for admin pgs that would never display in widget --></ui:remove>
                            <a id="breadcrumbLnk#{status.index}" href="${breadcrumb.url}">
                                <h:outputText value="#{breadcrumb.breadcrumbText}"/>
                            </a>
                        </ui:fragment>
                        <ui:fragment rendered="#{breadcrumb.dvObject.instanceofDataverse}">
                            <c:set var="dvUrl" value="/dataverse/#{breadcrumb.dvObject.alias}"/>
                            <a id="breadcrumbLnk#{status.index}" href="#{widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? widgetWrapper.wrapURL(dvUrl) : dvUrl}" target="#{!widgetWrapper.widgetView or widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? '' : '_blank'}">
                                <h:outputText value="#{breadcrumb.breadcrumbText}"/>
                            </a>
                        </ui:fragment>
                        <ui:fragment rendered="#{breadcrumb.dvObject.instanceofDataset}">
                            <c:set var="dsUrl" value="/dataset.xhtml?persistentId=#{breadcrumb.dvObject.globalId}#{breadcrumb.optionalUrlExtension }"/>
                            <a id="breadcrumbLnk#{status.index}" href="#{widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? widgetWrapper.wrapURL(dsUrl) : dsUrl}" target="#{!widgetWrapper.widgetView or widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? '' : '_blank'}">
                                <h:outputText value="#{breadcrumb.breadcrumbText}"/>
                            </a>
                        </ui:fragment>
                        <ui:fragment rendered="#{breadcrumb.dvObject.instanceofDataFile}">
                            <c:set var="dsUrl" value="/file.xhtml?fileId=#{breadcrumb.dvObject.id}#{breadcrumb.optionalUrlExtension }"/>
                            <a id="breadcrumbLnk#{status.index}" href="#{widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? widgetWrapper.wrapURL(dsUrl) : dsUrl}" target="#{!widgetWrapper.widgetView or widgetWrapper.isWidgetTarget(breadcrumb.dvObject) ? '' : '_blank'}">
                                <h:outputText value="#{breadcrumb.breadcrumbText}"/>
                            </a>
                        </ui:fragment>
                    </ui:fragment>
                </div>
            </ui:repeat>
        </div>

        <ui:remove>
            <!-- Removing this temporarily until we can fix the performance issues with it;
                 replaced with generic bookmarks; will have to see how to best make this work-->
            <div class="dropdown #{dataverseHeaderFragment.hasVisibleChildren(dv) ? 'dropdown-toggle keep-on' : ''}" data-delay="#{dataverseHeaderFragment.hasVisibleChildren(dv) ? '800' : ''}" data-hover="#{dataverseHeaderFragment.hasVisibleChildren(dv) ? 'dropdown' : ''}" data-target="#{dataverseHeaderFragment.hasVisibleChildren(dv) ? '#' : ''}" data-close-others="#{dataverseHeaderFragment.hasVisibleChildren(dv) ? 'true' : ''}">
                <h:outputText value="#{dv.name}" styleClass="#{dataverse.id == dv.id ? 'breadcrumbActive' : ''}" rendered="#{dataverse.id == dv.id and dataset == null}"/>
                <ui:fragment rendered="#{dataverse.id != dv.id or dataset != null}" >
                    <a id="breadcrumbLnk#{status.index}" href="/dataverse/#{dv.alias}">
                        <h:outputText value="#{dv.name}"/>
                    </a>
                </ui:fragment>

                <ui:fragment rendered="#{dataverseHeaderFragment.hasVisibleChildren(dv)}">
                    <a id="taverse" styleClass="#{dataverse.id == dv.id ? 'breadcrumbActive' : ''}" role="button">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </a>
                </ui:fragment>
            </div>
            <div class="dropdown-menu" role="menu" aria-labelledby="breadcrumbLnk#{status.index}" rendered="#{dataverseHeaderFragment.hasVisibleChildren(dv)}">
                <p:tree value="#{dataverseHeaderFragment.getDataverseTree(dv)}" var="node"  cache="true" id="tree">
                    <p:treeNode>
                        <h:outputText value="#{node.name}" styleClass="breadcrumbActive" rendered="#{dataverse.id == node.id and dataset == null}"/>
                        <h:outputLink value="/dataverse/#{node.alias}" rendered="#{dataverse.id != node.id or dataset != null}">
                            <h:outputText value="#{node.name}"/>
                        </h:outputLink>
                    </p:treeNode>
                </p:tree>
            </div>
        </ui:remove>

        <!-- Message Panel -->
        <p:fragment id="messagePanel" rendered="#{showMessagePanel}">
            <div class="container messagePanel">
                <ui:remove>
                    <!--change this to <h:messages id="messages"/> to see otherwise hidden errors such as `Conversion Error setting value 'foo.jpg' for 'null Converter'`-->
                </ui:remove>
                <iqbs:messages id="messages" collapsible="true" />
            </div>
        </p:fragment>
    </div>
    
    <!-- QDRCustom -->
    <script>
        $(document).ready(function () {        

            $('ul.nav li.dropdown').hover(function() {
                $(this).css('background-color', '#e7e7e7');
                $(this).find('.dropdown-menu').stop(true, true).fadeIn(200);
            }, function() {
                $(this).css('background-color', 'transparent');
                $(this).find('.dropdown-menu').stop(true, true).fadeOut(200);
            });

        });
    </script>
</ui:composition>
