# Dataverse Software 5.9

This release brings new features, enhancements, and bug fixes to the Dataverse Software. Thank you to all of the community members who contributed code, suggestions, bug reports, and other assistance across the project.

## Release Highlights

### XXX

## Major Use Cases and Infrastructure Enhancements

Newly-supported major use cases in this release include:

- XXX (Issue #XXX, PR #XXX)

## Notes for Dataverse Installation Administrators

### Mitigate Solr Schema Management Problems

XXX

## New JVM Options and DB Settings

- :Settingname XXX

## Complete List of Changes

For the complete list of code changes in this release, see the [5.9 Milestone](https://github.com/IQSS/dataverse/milestone/100?closed=1) in Github.

For help with upgrading, installing, or general questions please post to the [Dataverse Community Google Group](https://groups.google.com/forum/#!forum/dataverse-community) or email support@dataverse.org.

## Installation

If this is a new installation, please see our [Installation Guide](https://guides.dataverse.org/en/5.9/installation/). Please also contact us to get added to the [Dataverse Project Map](https://guides.dataverse.org/en/5.9/installation/config.html#putting-your-dataverse-installation-on-the-map-at-dataverse-org) if you have not done so already.

## Upgrade Instructions

0\. These instructions assume that you've already successfully upgraded from Dataverse Software 4.x to Dataverse Software 5 following the instructions in the [Dataverse Software 5 Release Notes](https://github.com/IQSS/dataverse/releases/tag/v5.0). After upgrading from the 4.x series to 5.0, you should progress through the other 5.x releases before attempting the upgrade to 5.9.

If you are running Payara as a non-root user (and you should be!), **remember not to execute the commands below as root**. Use `sudo` to change to that user first. For example, `sudo -i -u dataverse` if `dataverse` is your dedicated application user.  

In the following commands we assume that Payara 5 is installed in `/usr/local/payara5`. If not, adjust as needed.

`export PAYARA=/usr/local/payara5`

(or `setenv PAYARA /usr/local/payara5` if you are using a `csh`-like shell)

1\. Undeploy the previous version.

- `$PAYARA/bin/asadmin list-applications`
- `$PAYARA/bin/asadmin undeploy dataverse<-version>`

2\. Stop Payara and remove the generated directory

- `service payara stop`
- `rm -rf $PAYARA/glassfish/domains/domain1/generated`

3\. Start Payara

- `service payara start`
  
4\. Deploy this version.

- `$PAYARA/bin/asadmin deploy dataverse-5.9.war`

5\. Restart payara

- `service payara stop`
- `service payara start`

6\. Update Solr schema.xml.

`/usr/local/solr/solr-8.8.1/server/solr/collection1/conf` is used in the examples below as the location of your Solr schema. Please adapt it to the correct location, if different in your installation. Use `find / -name schema.xml` if in doubt.

6a\. Replace `schema.xml` with the base version included in this release.

```
   wget https://github.com/IQSS/dataverse/releases/download/v5.9/schema.xml
   cp schema.xml /usr/local/solr/solr-8.8.1/server/solr/collection1/conf
```

For installations that are not using any Custom Metadata Blocks, **you can skip the next step**.

6b\. For installations with Custom Metadata Blocks

Use the script provided in the release to add the custom fields to the base `schema.xml` installed in the previous step.

```
   wget https://github.com/IQSS/dataverse/releases/download/v5.9/update-fields.sh
   chmod +x update-fields.sh
   curl "http://localhost:8080/api/admin/index/solr/schema" | ./update-fields.sh /usr/local/solr/solr-8.8.1/server/solr/collection1/conf/schema.xml
```

(Note that the curl command above calls the admin api on `localhost` to obtain the list of the custom fields. In the unlikely case that you are running the main Dataverse Application and Solr on different servers, generate the `schema.xml` on the application node, then copy it onto the Solr server)

7\. Restart Solr

Usually `service solr stop; service solr start`, but may be different on your system. See the [Installation Guide](https://guides.dataverse.org/en/5.9/installation/prerequisites.html#solr-init-script) for more details.
