# Dataverse 6.2

Please note: To read these instructions in full, please go to https://github.com/IQSS/dataverse/releases/tag/v6.3 rather than the list of releases, which will cut them off.

This release brings new features, enhancements, and bug fixes to the Dataverse software.
Thank you to all of the community members who contributed code, suggestions, bug reports, and other assistance across the project.

# Table of Contents
- [Release Highlights](#release-highlights)
- [Bug fixes](#-bug-fixes)
- [Persistence](#-persistence)
- [API](#-api)
- [Backward Incompatibilities](#%EF%B8%8F-backward-incompatibilities)
- [Guides](#-guides)
- [New Settings](#%EF%B8%8F-new-settings)
- [Complete List of Changes](#-complete-list-of-changes)
- [Getting Help](#-getting-help)
- [Upgrade instructions](#-upgrade-instructions)

## Release Highlights

### Improved use of Dataverse thumbnail

Dataverse will use the Dataset thumbnail, if one is defined, rather than the generic Dataverse logo in the Open Graph metadata header. This means the image will be seen when, for example, the dataset is referenced on Facebook.

[⬆](#table-of-contents)

## Bug fixes
[⬆](#table-of-contents)

## Persistence
[⬆](#table-of-contents)

## API 
[⬆](#table-of-contents)

## Backward Incompatibilities
[⬆](#table-of-contents)

## Guides
[⬆](#table-of-contents)

## New Settings 
[⬆](#table-of-contents)

### MicroProfile Settings

### SMTP Settings: 

### Database Settings:

## Complete List of Changes

For the complete list of code changes in this release, see the [6.3 Milestone](https://github.com/IQSS/dataverse/issues?q=milestone%3A6.3+is%3Aclosed) in GitHub.

[⬆](#table-of-contents)

## Getting Help

For help with upgrading, installing, or general questions please post to the [Dataverse Community Google Group](https://groups.google.com/forum/#!forum/dataverse-community) or email support@dataverse.org.

[⬆](#table-of-contents)

## Upgrade Instructions

Upgrading requires a maintenance window and downtime. Please plan accordingly, create backups of your database, etc.

These instructions assume that you've already upgraded through all the 5.x releases and are now running Dataverse 6.2.

0\. These instructions assume that you are upgrading from the immediate previous version. If you are running an earlier version, the only safe way to upgrade is to progress through the upgrades to all the releases in between before attempting the upgrade to this version.

If you are running Payara as a non-root user (and you should be!), **remember not to execute the commands below as root**. Use `sudo` to change to that user first. For example, `sudo -i -u dataverse` if `dataverse` is your dedicated application user.

In the following commands, we assume that Payara 6 is installed in `/usr/local/payara6`. If not, adjust as needed.

`export PAYARA=/usr/local/payara6`

(or `setenv PAYARA /usr/local/payara6` if you are using a `csh`-like shell)

1\. Usually, when a Solr schema update is released, we recommend deploying the new version of Dataverse and then updating the `schema.xml` on the Solr side. With 6.2, we recommend to install the base schema first. Without it, Dataverse 6.2 is not going to be able to show any results after the initial deployment. If your instance is using any custom metadata blocks, you will need to further modify the schema, see the last step of this instruction (step 8).

- Stop Solr instance (usually `service solr stop`, depending on Solr installation/OS, see the [Installation Guide](https://guides.dataverse.org/en/6.2/installation/prerequisites.html#solr-init-script))

- Replace schema.xml

  - `wget https://raw.githubusercontent.com/IQSS/dataverse/master/conf/solr/9.3.0/schema.xml`
  - `cp schema.xml /usr/local/solr/solr-9.3.0/server/solr/collection1/conf`

- Start Solr instance (usually `service solr start`, depending on Solr/OS)

2\. Undeploy the previous version.

- `$PAYARA/bin/asadmin undeploy dataverse-6.1`

3\. Stop Payara and remove the generated directory

- `service payara stop`
- `rm -rf $PAYARA/glassfish/domains/domain1/generated`

4\. Start Payara

- `service payara start`

5\. Deploy this version.

- `$PAYARA/bin/asadmin deploy dataverse-6.2.war`

As noted above, deployment of the war file might take several minutes due a database migration script required for the new storage quotas feature.

6\. For installations with internationalization:

- Please remember to update translations via [Dataverse language packs](https://github.com/GlobalDataverseCommunityConsortium/dataverse-language-packs).

7\. Restart Payara

- `service payara stop`
- `service payara start`

8\. Update the following Metadata Blocks to reflect the incremental improvements made to the handling of core metadata fields: 

 ```
 wget https://github.com/IQSS/dataverse/releases/download/v6.2/geospatial.tsv

 curl http://localhost:8080/api/admin/datasetfield/load -H "Content-type: text/tab-separated-values" -X POST --upload-file scripts/api/data/metadatablocks/geospatial.tsv

wget https://github.com/IQSS/dataverse/releases/download/v6.2/citation.tsv

curl http://localhost:8080/api/admin/datasetfield/load -H "Content-type: text/tab-separated-values" -X POST --upload-file scripts/api/data/metadatablocks/citation.tsv

wget https://github.com/IQSS/dataverse/releases/download/v6.2/astrophysics.tsv

curl http://localhost:8080/api/admin/datasetfield/load -H "Content-type: text/tab-separated-values" -X POST --upload-file scripts/api/data/metadatablocks/astrophysics.tsv

wget https://github.com/IQSS/dataverse/releases/download/v6.2/biomedical.tsv

curl http://localhost:8080/api/admin/datasetfield/load -H "Content-type: text/tab-separated-values" -X POST --upload-file scripts/api/data/metadatablocks/biomedical.tsv
```

9\. For installations with custom or experimental metadata blocks:

- Stop Solr instance (usually `service solr stop`, depending on Solr installation/OS, see the [Installation Guide](https://guides.dataverse.org/en/6.2/installation/prerequisites.html#solr-init-script))

- Run the `update-fields.sh` script that we supply, as in the example below (modify the command lines as needed to reflect the correct path of your solr installation):
```
	wget https://raw.githubusercontent.com/IQSS/dataverse/master/conf/solr/9.3.0/update-fields.sh
	chmod +x update-fields.sh
	curl "http://localhost:8080/api/admin/index/solr/schema" | ./update-fields.sh /usr/local/solr/solr-9.3.0/server/solr/collection1/conf/schema.xml
```
     
- Restart Solr instance (usually `service solr restart` depending on solr/OS)

10\. Reindex Solr:

   For details, see https://guides.dataverse.org/en/6.2/admin/solr-search-index.html but here is the reindex command:

```
   curl http://localhost:8080/api/admin/index

[⬆](#table-of-contents)
